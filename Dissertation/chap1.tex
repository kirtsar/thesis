\chapter{Основные определения и обозначения}\label{sec:intro}

    В настоящей главе мы приведем основные определения, необходимые для дальнейшего рассмотрения.
    В разделе~\ref{sec:notation} приведены основные обозначения, используемые на протяжении всей работы.
    Раздел~\ref{sec:prelim} посвящен введению базовых понятий ($d$-)квазигруппы и семейства отображений.
    В разделе~\ref{sec:proper} вводится основной объект исследования~--- правильные семейства функций.
    В разделе~\ref{sec:quasi_properties} кратко рассматриваются основные характеристики квазигрупп, важные в контексте криптографических приложений (индекс ассоциативности, полиномиальная полнота, наличие подквазигрупп).

    Отдельно рассмотрен один выделенный класс семейств~(\ref{example:family1}):
    \begin{itemize}
        \item показано, что этот класс семейств является правильным (теорема~\ref{thm:quadfamily});
        \item доказана теорема о сильной квадратичности семейства (теорема~\ref{thm:strongquad}).
    \end{itemize}

    Введена конструкция, позволяющая строить квазигруппы на основе пары правильных семейств (теорема~\ref{thm:regularity}), доказан ряд утверждений о количестве ассоциативных троек в квазигруппах, получаемых с помощью указанной конструкции (раздел~\ref{sec:assoctriples_proper}).

    Результаты главы были опубликованы в~\cite{dm21, galatenko23, galatenko2023proper, tsar24}.



\section{Основные обозначения}
\label{sec:notation}

    Введем основные обозначения, используемые на протяжении всей работы.
    \begin{itemize}
        \item $\QQQ$~--- прямое (декартово) произведение множеств $Q_1, \ldots, Q_n$; если на $Q_i$ заданы некоторые операции $\circ_i$, то они переносятся покоординатно на прямое произведение.
        \item $\GGG$~--- некоторая группа с операцией \textquote{$\cdot$}.
        \item $d(\xx, \yy)$~--- метрика Хэмминга; метрическое пространство, снабженное метрикой Хэмминга, будем называть пространством Хэмминга.
        \item $Func(A, B)$~--- множество функций $\{f \mid f \colon A \to B \}$.
        \item $\SSS_Q$~--- группа подстановок (биекций с операцией композиции) на множестве $Q$, $\SSS_n$~--- группа подстановок на множестве $Q = \{1, \ldots, n\}$.
        \item $\EE_k$~--- множество $\{0, 1, \ldots, k-1 \}$.
        \item $\ff_n$, $\gf_n$~--- семейства функций на $\QQQ$.
        \item $\mathsf{id}$~--- тождественное отображение, $\mathsf{id}(x) = x$.
        \item $\mathsf{inv}$~--- отображение <<переворота>>, ставящее для любого $n$ в соответствие набору $\xx \in Q^n$ набор $\yy \in Q^n$ следующим образом: $y_i = x_{n-i+1}$, $1 \le i \le n$.
        \item $Aut(X)$~--- группа автоморфизмов объекта $X$.
        \item $Mult(Q)$~--- группа умножений квазигруппы $Q$.
        \item $\NN$~--- множество натуральных чисел.
    \end{itemize}

    Набор элементов будет обозначаться либо жирным шрифтом: $\xx, \yy, \vv$ и так далее, либо греческими символами $\alpha$, $\beta$.
    Если $\xx = (x_1, \ldots, x_n)$, $\yy = (y_1, \ldots, y_m)$, то под записью 
    \[
        \begin{bmatrix}
            \xx \\
            \yy 
        \end{bmatrix}
    \] 
    мы подразумеваем вектор-столбец $(x_1, \ldots, x_n, y_1, \ldots, y_m)^T$.
    Если $b \in \{0, 1\}$, то $b^n$~--- вектор-столбец 
    \[
        b^n = \left( \underbrace{b, \ldots, b}_{n \text{ раз }} \right)^T.
    \]
    Если $n, m \in \NN$, то $m \divides n$ означает, что $m$ делит число $n$.

    Пусть $f, g \colon \NN \to \NN$.
    Будем писать
    \begin{itemize}
        \item $f = \mathcal{O}(g)$, если 
        \[
            \exists M \; \exists N \; \forall n > N \colon f(n) < M \cdot g(n);
        \]
        \item $f = \Theta(g)$, если 
        \[
            \exists m > 0 \; \exists M \; \exists N \; \forall n > N \colon m \cdot g(n) < f(n) < M \cdot g(n);
        \]
        \item $f = o(g)$, если 
        \[
            \forall \epsilon > 0 \; \exists N \; \forall n > N \colon f(n) < \epsilon \cdot g(n);
        \]
        \item $f \sim g$, если 
        \[
            \forall \epsilon > 0 \; \exists N \; \forall n > N \colon \lvert \frac{f(n)}{g(n)} - 1 \rvert < \epsilon;
        \]
        \item $f \lesssim g$, если существует $h$ такое, что выполнены условия
        \[
            f \le h, \; h \sim g.
        \]
    \end{itemize}

    Все остальные обозначения будут вводиться в основном тексте работы.



\section{Предварительные определения}
\label{sec:prelim}

    В настоящем разделе мы введем основные определения, связанные с квазигруппами, дискретными функциями и семействами функций на множествах.

\subsection{Квазигруппы}
\label{sec:quasigroup}

    Приведем стандартные определения из теории квазигрупп (более подробно см., например,~\cite{keedwell, belousov, galkin88}).

    \begin{definition}
    \label{def:quasigroup}
        Квазигруппой называется множество $Q$ с заданной на нем бинарной операцией 
        \(
            \circ \colon Q \times Q \to Q,
        \)
        удовлетворяющей следующему условию: для любых $a, b \in Q$ найдутся единственные элементы $x, y \in Q$~---~решения уравнений
        \[
            a \circ x = b, \quad y \circ a = b.
        \]
    \end{definition}

    Далее мы будем рассматривать конечные квазигруппы $\lvert Q \rvert < \infty$, для краткости слово \textquote{конечный} будем опускать.

    \begin{remark}
    \label{rem:LR}
        Пусть $Q$~--- квазигруппа, тогда мы можем задать операции левого $L_a$ и правого $R_a$ сдвига на элемент $a \in Q$:
        \begin{gather*} 
            L_a \colon Q \to Q,\, L_a(x) = a \circ x, \\
            R_a \colon Q \to Q,\, R_a(y) = y \circ a.
        \end{gather*}
        Операции $L_a$ и $R_a$ задают биективные отображения на множестве $Q$: $L_a, R_a \in \SSS_Q$.
    \end{remark}

    \begin{definition}
    \label{def:latsquare}
        Латинский квадрат размера $k$~--- это квадратная таблица $k \times k$, заполненная элементами $k$ различных типов таким образом, что в каждой строке и в каждом столбце элемент каждого типа встречается ровно один раз.
    \end{definition}

    \begin{definition}
        Пусть $Q = \{q_1, \ldots, q_k\}$~--- квазигруппа, тогда мы можем рассмотреть ее таблицу умножения: квадратную таблицу $k \times k$, заполненную элементами $q \in Q$ таким образом, что на пересечении $i$-й строки и $j$-го столбца записывается произведение $\left( q_i \circ q_j \right) \in Q$. 
    \end{definition}

    \begin{remark}
        Латинские квадраты являются таблицами умножения квазигрупп.
        Это следует из того факта, что левые и правые сдвиги являются биекциями. 
    \end{remark}

    Далее мы будем отождествлять квазигруппу с латинским квадратом, задающим ее таблицу умножения.

    Понятие квазигруппы может быть обобщено на операции большей арности.
    \begin{definition}
    \label{def:dquasigroup}
        Множество $Q$ с заданной на нем $d$-арной операцией $h \colon Q^d \to Q$, удовлетворяющей следующему условию: при любой фиксации $d$ переменных из набора $a_1, \ldots, a_d, a_{d+1} \in Q$ уравнение
        \begin{equation}
        \label{eq:dquasi}
            h(a_1, \ldots, a_d) = a_{d+1}
        \end{equation}
        однозначно разрешимо (относительно свободной переменной), называется \mbox{$d$-квазигруппой}.
    \end{definition}

    \begin{remark}
        Квазигруппа является $d$-квазигруппой с $d = 2$.
    \end{remark}

    \begin{remark}
        Многомерная \textquote{таблица} умножения $d$-квазигруппы $Q$ является латинским (гипер)кубом.
        На пересечении \textquote{строк} таблицы с номерами $i_1, \ldots, i_d$ будем писать значение $h(q_{i_1}, \ldots, q_{i_d})$.
        В таком случае по свойству однозначной разрешимости уравнений~(\ref{eq:dquasi}) при фиксации любых $d-1$ номеров строк полученной таблицы оставшиеся элементы будут пробегать все множество $Q$.
    \end{remark}

    \begin{example}[пример $d$-квазигруппы]
        Для группы $(\GGG, \cdot)$ и элемента $g \in \GGG$ мы можем определить $d$-квазигрупповую операцию следующим способом:
        \[
            h(x_1, \ldots, x_d) = x_1 \cdot \ldots \cdot x_d \cdot g.
        \]
    \end{example}

    \begin{definition}
    \label{def:isotopy}
        Пусть $Q$~---~квазигруппа с операцией~$\circ$. 
        Ее изотопом называется квазигруппа $Q_{\alpha \beta \gamma}$ с операцией $*$, заданной на том же множестве по следующему правилу:
        \[
            a * b = \gamma^{-1}(\alpha(a) \circ \beta(b)),
        \]
        где $\alpha, \beta, \gamma \in \SSS_Q$~--- подстановки на множестве~$Q$.
    \end{definition}
    
    \begin{definition}
    \label{def:main_isotopy}
        Главным изотопом $Q_{\alpha \beta}$ называется изотоп квазигруппы $Q$ с дополнительным условием $\gamma = \mathsf{id}$, где $\mathsf{id}$~--- тождественное отображение на $Q$.
    \end{definition}
    
    \begin{definition}
    \label{def:orthomorphism}
        Биекция $\theta \in \SSS_Q$ называется полным отображением (complete mapping) квазигруппы $Q$, если отображение
        \[
            \sigma \colon Q \to Q, \quad \sigma(x) = x \circ \theta(x)
        \] 
        также является биекцией $\sigma \in \SSS_Q$.
        Если $\theta$~--- полное отображение, то ассоциированное с ним отображение $\sigma$ называется ортоморфизмом.
    \end{definition}

    % \begin{remark}
    %     В книге~\cite{keedwell} введенный выше объект полным преобразованием (complete mapping), однако в русском языке более распространенное название подобного объекта~--- ортоморфизм.
    % \end{remark}

    \begin{definition}
    \label{def:transversal}
        Трансверсалью в латинском квадрате $L$ размера $k \times k$ называется множество троек $(i, j, q)$ мощности $k$, таких что $L[i, j] = q$, и для каждой пары $(i, j, q)$ и $(i', j', q')$ выполнены неравенства:
        \[
            i \ne i', \; j \ne j', \; q \ne q'.
        \]
    \end{definition}
    
    \begin{remark}
        Существование полного отображения в квазигруппе эквивалентно существованию трансверсали в ее таблице умножения~\cite[теорема~1.5.1]{keedwell}.
    \end{remark}
    
    \begin{definition}
    \label{def:idempotent}
        Идемпотентом в квазигруппе $Q$ называется элемент $x \in Q$ со свойством $x \circ x = x$.
    \end{definition}

    Фактически, идемпотент $x$ является подквазигруппой размера~1 (см. раздел~\ref{sec:subquasi}).




\subsection{Дискретные функции}
\label{sec:discretefunctions}
    Напомним некоторые понятия из теории булевых функций (см., например,~\cite{yablonski}).

    Мы будем использовать стандартные обозначения $\bar{x}$, $\oplus$, $\cdot$, $\vee$ для логического отрицания, сложения по модулю 2, умножения по модулю 2 (логического \textquote{И}) и логического \textquote{ИЛИ} соответственно.

    \begin{remark}[полином Жегалкина]
        Каждая булева функция $f \colon \EE_2^n \to \EE_2$ единственным образом представима в виде полинома, называемого полиномом Жегалкина~\cite[часть~I, глава~5]{yablonski}: 
        \[
            \bigoplus_{\alpha \in \EE_2^n} a_{\alpha} x_1^{\alpha_1} \cdot \ldots \cdot x_n^{\alpha_n},
        \]
        где $a_{\alpha} \in \EE_2$, $x^0 \coloneqq 1$, $x^1 \coloneqq x$, суммирование ведется по модулю 2.

        Произведение вида $x_1^{\alpha_1} \cdot \ldots \cdot x_n^{\alpha_n}$ называется мономом, а число $\alpha_1 + \ldots + \alpha_n$~--- степенью монома.
    \end{remark}

    \begin{definition}
        \label{def:degree}
        Под степенью булевой функции будем понимать максимальную степень монома в полиноме Жегалкина для этой функции.
    \end{definition}

    В силу единственности представления булевой функции полиномом Жегалкина понятие степени булевой функции определено корректно.

    \begin{definition}
    \label{def:hammingdist}
        Пусть $\xx, \yy \in \EE_2^n$, тогда расстояние Хэмминга $d(\xx, \yy)$ между наборами $\xx$ и $\yy$ определяется как число несовпадающих координат векторов:
        \[
            d(\xx, \yy) = \lvert \{1 \le i \le n \mid \xx[i] \ne \yy[i] \} \rvert.
        \]
    \end{definition}

    \begin{definition}
        Пусть $p(X) \in \FF_q[X]$~--- многочлен над конечным полем.
        Многочлен $p$ называется перестановочным, если отображение $x \to p(x)$, $x \in \FF_q$, биективно.
    \end{definition}



\subsection{Семейства функций и их преобразования}
\label{sec:families}

    В этом разделе мы введем понятие семейства функций, а также определим некоторые преобразования, которые можно осуществлять над семействами.

\subsubsection{Семейство функций}

    \begin{definition}
    \label{def:family}
        Пусть $Q_1, \ldots, Q_n$~--- набор непустых конечных множеств.
        Под семейством функций $\ff_n$ на $\QQQ$ будем понимать отображение вида
        \begin{gather*}
            \ff_n \colon \QQQ \to \QQQ, \\
            \ff_n \colon
            \begin{bmatrix}
                x_1 \\
                \vdots \\
                x_n
            \end{bmatrix}
            \to
            \begin{bmatrix}
                f_1(x_1, \ldots, x_n) \\
                \vdots \\
                f_n(x_1, \ldots, x_n) 
            \end{bmatrix},
        \end{gather*}
        где $f_i(x_1, \ldots, x_n) \colon \QQQ \to Q_i$.
        Число $n$ будем называть размером семейства.
        Иногда мы будем опускать размер семейства $n$ из обозначения $\ff_n$, если он понятен из контекста.
    \end{definition}

    \begin{remark}
        Часто в качестве множеств $Q_i$ у нас будут выступать конечные квазигруппы $(Q_i, \circ_i)$ или конечные группы $(\GGG_i, +_i)$.
        В таком случае мы будем предполагать, что на прямом произведении $Q_i$ задана операция покоординатного умножения: для $\xx, \yy \in \QQQ$ определим $\xx \circ \yy$ равенством
        \[
            \xx \circ \yy = \left( x_1 \circ_1 y_1, \ldots, x_n \circ_n y_n \right).
        \]
        Заметим также, что в большинстве случаев мы рассматриваем произведение из $n$ одинаковых экземпляров (квази)группы, т.е. 
        \[
            Q_1 = \ldots = Q_n = Q, \quad \circ_1 = \ldots = \circ_n = \circ.
        \]
    \end{remark}

    \begin{definition}
        \label{def:sufficient_one}
        Функция $f$ существенно зависит от переменной $x_i$, если найдутся два набора значений
        \[
            \alpha = \left( \alpha_1, \ldots, \alpha_{i-1}, a, \alpha_{i+1}, \ldots, \alpha_n \right) \quad \beta = \left(\alpha_1, \ldots, \alpha_{i-1}, b, \alpha_{i+1}, \ldots, \alpha_n \right),
        \]
        такие что $f(\alpha) \ne f(\beta)$. 
    \end{definition}

    Определение~\ref{def:sufficient_one} напрямую обобщается на семейства функций.

    \begin{definition}
    \label{def:sufficient}
        Будем говорить, что семейство $\ff_n$ существенно зависит от переменной $x_i$, если найдутся два набора значений
        \[
            \alpha = \left( \alpha_1, \ldots, \alpha_{i-1}, a, \alpha_{i+1}, \ldots, \alpha_n \right) \quad \beta = \left(\alpha_1, \ldots, \alpha_{i-1}, b, \alpha_{i+1}, \ldots, \alpha_n \right),
        \]
        такие что $\ff_n(\alpha) \ne \ff_n(\beta)$.
    \end{definition}

    В работе~\cite{nosov08} было введено следующее определение.
    \begin{definition}
    \label{def:essgraph}
        Графом существенной зависимости семейства функций $\ff_n$ будем называть ориентированный граф $G_{\ff} = (V, E)$, множество вершин которого равно $V = \{1, \ldots, n\}$, а вершины $i$ и $j$ соединены ориентированным ребром $i \to j$ в том и только в том случае, когда функция $f_j$ существенно зависит от $x_i$ (см. определение~\ref{def:sufficient_one}).
    \end{definition}

    \begin{remark}[петли в $G_{\ff}$]
        В терминах графа $G_{\ff}$ свойство существенной зависимости $f_i$ от $x_i$ эквивалентно наличию петли $i \to i$ в графе $G_{\ff}$.
    \end{remark}
    
    В работе~\cite{MQQ} была введена следующая характеристика, которая показывает \textquote{степень нелинейности} булева отображения (строгий тип нелинейности).
    \begin{definition}
    \label{def:quadlin}
        Семейство булевых функций $\ff_n = (f_1, \ldots, f_n)$ называется квадратичным строгого типа $Quad^s_{v}Lin^s_{n - v}$, $1 \le v \le n$, если 
        \begin{itemize}
            \item каждая функция семейства не более чем квадратична, 
            \item имеется $v$ функций, все нетривиальные линейные комбинации которых квадратичны, 
            \item если $v < n$, то для любых $v+1$ функции найдется нетривиальная линейная комбинация, степень которой меньше двух.
        \end{itemize} 
        Если $v = n$, то семейство~$\ff_n$ называется сильно квадратичным.
    \end{definition}


\subsubsection{Преобразования семейств функций}
    Рассмотрим преобразования внешнего и внутреннего сдвига семейства.

    \begin{definition}
    \label{def:shift}
        Пусть $(Q_1, \circ_1), \ldots, (Q_n, \circ_n)$~--- квазигруппы, 
        \[
            \ss = (s_1, \ldots, s_n) \in \QQQ.
        \]
        Под \textbf{внешним сдвигом} семейства $\ff_n$ на $\ss$ будем понимать семейство $\gf_n$ вида
        \[
            \gf_n(\xx) = \ff_n(\xx) \circ \ss =
            \begin{bmatrix}
                f_1(x_1, \ldots, x_n) \circ_1 s_1 \\
                \vdots \\
                f_n(x_1, \ldots, x_n) \circ_n s_n \\
            \end{bmatrix}.
        \]
        Под \textbf{внутренним сдвигом} семейства $\ff_n$ на $\ss$ будем понимать семейство $\gf_n$ вида
        \[
            \gf_n(\xx) = \ff_n(\xx \circ \ss) = \ff_n(x_1 \circ_1 s_1, \ldots, x_n \circ_n s_n).
        \]
    \end{definition}

    Введем также действие группы подстановок $\SSS_n$ на множестве векторов фиксированного размера $n$.

    \begin{definition}
    \label{def:sigma_vec}
        Для подстановки $\sigma \in \SSS_n$ и вектора $\xx \in Q^n$ мы можем рассмотреть преобразование
        \[
            \xx \to \sigma(\xx) = \left(x_{\sigma^{-1}(1)}, \ldots, x_{\sigma^{-1}(n)} \right),
        \]
        которое переводит компоненту $x_i$ вектора $\xx$ на место компоненты $x_{\sigma(i)}$.
    \end{definition}

    \begin{definition}
    \label{def:sigma}
        Для пары подстановок $\sigma, \tau \in \SSS_n$ и семейства $\ff_n \colon Q^n \to Q^n$ размера $n$ рассмотрим семейство $(\sigma, \tau)(\ff_n)$, которое получено из $\ff_n$ с помощью перестановки индексов переменных и индексов входящих в семейство функций:
        \[
            (\sigma, \tau)(\ff_n) = 
            \begin{bmatrix}
                f_{\sigma^{-1}(1)} \left( x_{\tau^{-1}(1)}, \ldots, x_{\tau^{-1}(n)} \right) \\
                \vdots \\
                f_{\sigma^{-1}(n)} \left( x_{\tau^{-1}(1)}, \ldots, x_{\tau^{-1}(n)} \right)
            \end{bmatrix},
        \]
        т.е. функция (переменная) с номером $i$ переходит на место функции (переменной) с номером $\sigma(i)$ ($\tau(i)$).
        Введем также преобразование $\sigma(\ff_n)$ следующим образом:
        \[
            \sigma(\ff_n) = (\sigma, \sigma)(\ff_n).
        \]
        Другими словами, $\sigma(\ff_n)$~--- семейство, полученное применением подстановки $\sigma$ как к индексам функций, так и индексам координат.
        Таким образом введенное преобразование будем называть \textbf{согласованной перестановкой семейства.}
    \end{definition}

    Введем понятие проекции и сужения семейства.

    \begin{definition}
    \label{def:proj}
        Пусть $\ff_n$~--- семейство размера $n$ на $\QQQ$.
        Под проекцией семейства $\proj_i^{q} \left( \ff_n \right)$, где $q \in Q_i$, будем понимать семейство $\gf_{n-1}$, полученное из $\ff_n$ подстановкой вместо $x_i$ константы $q$ и вычеркиванием функции $f_i$:
        \begin{gather*}
            \gf_{n-1}(x_1, \ldots, x_{i-1}, x_{i+1}, \ldots, x_n) = \proj_i^{q} \left( \ff_n \right) = \\
            = \begin{bmatrix}
                f_1(x_1,\ldots,x_{i-1}, q, x_{i+1}, \ldots, x_n) \\
                \vdots \\
                f_{i-1}(x_1,\ldots,x_{i-1}, q, x_{i+1}, \ldots, x_n) \\
                f_{i+1}(x_1,\ldots,x_{i-1}, q, x_{i+1}, \ldots, x_n) \\
                \vdots \\
                f_{n}(x_1,\ldots,x_{i-1}, q, x_{i+1}, \ldots, x_n) \\
            \end{bmatrix}.
        \end{gather*}
        Аналогичным образом вводится кратная проекция семейства:
        \[
            \proj_{i_1, \ldots, i_k}^{q_1, \ldots, q_k} \left( \ff_n \right) = 
            \proj_{i_1}^{q_1} \left( \ldots \left( \proj_{i_k}^{q_k}\left( \ff_n \right) \right) \ldots \right).
        \]
    \end{definition}

    \begin{remark}
        Далее мы будем предполагать, что исходное семейство также является своей проекцией, т.е. тождественное преобразование также является (тривиальной) проекцией.
    \end{remark}

    \begin{definition}
        Пусть $\ff_n$~--- семейство на $\QQQ$, $q \in Q_i$.
        Тогда сужением семейства $\ff_n$ будем называть набор функций $\gf$ от $n-1$ переменной, где каждая функция задана на подмножестве $\QQQ$ с $i$-й фиксированной координатой~$x_i \coloneqq q$:
        \[
            \gf(x_1, \ldots, x_{i-1}, x_{i+1}, \ldots, x_n) = \ff_n(x_1, \ldots, x_{i-1}, q, x_{i+1}, \ldots, x_n).
        \]
        Аналогичным образом вводится сужение на несколько координат.
    \end{definition}










\section{Правильные семейства функций}
\label{sec:proper}

    В этом разделе мы введем определение для основного объекта исследования~--- правильного семейства функций.
    Мы рассмотрим как булев, так и общий случай.
    Заметим, что с точки зрения практических приложений булев случай является одним из наиболее интересных.

\subsection{Правильные семейства булевых функций}
\label{sec:boolean_proper}

    Понятие правильного семейства булевых функций было введено и исследовалось в работах~\cite{nosov98, nosov99}.

    \begin{definition}
    \label{def:proper_bool}
        Семейство булевых функций 
        \[ 
            \ff_n \colon \EE_2^n \to \EE_2^n, \quad
            \ff_n(\xx) = 
            \begin{bmatrix}
                f_1(x_1, \ldots, x_n) \\
                \vdots \\
                f_n(x_1, \ldots, x_n)
            \end{bmatrix},
        \]
        называется правильным, если для любых двух неравных двоичных наборов 
        \[
            \alpha = (\alpha_1, \ldots, \alpha_n), \quad 
            \beta = (\beta_1, \ldots, \beta_n), \quad 
            \alpha \ne \beta,
        \]
        выполняется следующее условие:
        \[ 
            \exists i \; \colon \; \alpha_i \ne \beta_i, \quad f_i(\alpha) = f_i(\beta). 
        \]
    \end{definition}

    Правильные семейства булевых функций могут использоваться для построения больших параметрических семейств латинских квадратов (см. определение~\ref{def:latsquare}) или, что эквивалентно, для задания структуры квазигруппы (см. определение~\ref{def:quasigroup}); а именно, верно утверждение.

    \begin{proposition}[{\cite[утверждение~2]{nosov99}}]
    \label{thm:properness}
        Рассмотрим следующую конструкцию. 
        Пусть $\xx, \yy \in \ZZ_2^n$, $\ff_n$~--- семейство функций размера $n$ на $\ZZ_2^n$, $\pi_i \colon \ZZ_2^2 \to \ZZ_2$~--- произвольные булевы функции, $1 \le i \le n$.
        Рассмотрим операцию $\circ$ на множестве $\EE_2^n$, задаваемую равенством
        \begin{equation}
        \label{eq:main_operation}
            \xx \circ \yy = \xx \oplus \yy \oplus \ff(\pi(\xx, \yy)),
        \end{equation}
        где через $\ff(\pi(\xx, \yy))$ обозначена конструкция
        \[
            \ff(\pi(\xx, \yy)) = 
            \begin{bmatrix}
                f_1(\pi_1(x_1, y_1), \ldots, \pi_n(x_n, y_n)) \\
                \vdots \\
                f_n(\pi_1(x_1, y_1), \ldots, \pi_n(x_n, y_n)) 
            \end{bmatrix}.
        \]
        Операция $\circ \colon \EE_2^n \times \EE_2^n \to \EE_2^n$ задает структуру квазигруппы на $\EE_2^n$ для любых функций $\pi_i$ тогда и только тогда, когда $\ff_n$~--- правильное семейство.
    \end{proposition}

    Функции $\pi_i$, $1 \le i \le n$, из условия утверждения~\ref{thm:properness} будем называть параметрическими функциями.
    Таким образом, варьируя параметрические функции $\pi_i$, можно получать (потенциально различные) квазигрупповые операции из одного заданного правильного семейства $\ff_n$.
    В работе~\cite[теорема~4]{galatenko23} оценивается снизу количество различных порождаемых квазигрупп (при варьировании параметрических функций с заданным фиксированным правильным семейством).
    При этом оценивается только число попарно различных квазигрупп (с различными таблицами умножения): оценка не учитывает тот факт, что различные полученные квазигруппы могут оказаться изотопными.

    \begin{proposition}[{\cite[теорема~4]{galatenko23}}]
    \label{thm:num_quasigroups}
        Пусть мощность образа отображения, индуцируемого семейством $\ff$, равна $M$:
        \[
            \ff \colon \xx \to \ff(\xx), \quad \lvert \Img(\ff) \rvert = M.
        \]
        Тогда операция~(\ref{eq:main_operation}) порождает не менее $M^{2^n}$ попарно различных квазигрупп.
    \end{proposition}

    Таким образом, мощность образа $\Img(\ff)$ является важной характеристикой правильного семейства $\ff$.

    Правильные семейства булевых функций могут быть определены различными эквивалентными способами.
    Далее приведем два из них.
    \begin{definition}
        Пусть $I = \{i_1, \ldots, i_s\} \subseteq \{1, \ldots, n\}$~--- некоторое подмножество индексов.
        Назовем набор переменных $\xx_I= (x_{i_1}, \ldots, x_{i_s})$ существенным для булевой функции $f(x_1, \ldots, x_n)$, если выполнено равенство
        \[
            \sum_{(\alpha_{1}, \ldots, \alpha_{s}) \in \EE_2^s}
            f(x_1, \ldots, x_{i_1-1}, \alpha_{1}, x_{i_1+1}, \ldots, x_{i_s-1}, \alpha_{s}, x_{i_s+1},
            \ldots, x_n) \not\equiv 0 \mod 2.
        \]
    \end{definition}

    \begin{remark}
    \label{rem:essential_boolean}
        Для одноэлементного множества $I = \{i \}$ мы получаем определение существенной зависимости булевой функции $f$ от $x_i$ (см. определение~\ref{def:sufficient_one}), для множества $I = \{1, \ldots, n\}$~--- требование нечетности веса булевой функции $f$.
    \end{remark}
    
    \begin{proposition}[{\cite[теорема~1]{nosov98}}]
    \label{thm:essential}
        Семейство булевых функций $\ff_n$ является правильным тогда и только тогда, когда для любого подмножества $I \subseteq \{1, \ldots, n\}$ набор переменных $\xx_I$ \textbf{не является} существенным для функции $f = \prod_{i \in I} f_i$.
    \end{proposition}

    Можно также привести следующий критерий правильности, основанный на регулярности преобразования, задаваемого с помощью семейства функций.
    \begin{proposition}[{\cite[теорема~2]{nosov06abel}}]
    \label{thm:regularity_boolean}
        Cемейство булевых функций $\ff_n(\xx)$ является правильным тогда и только тогда, когда для любого набора отображений 
        \[
            \Psi = \left(\psi_1, \ldots, \psi_n \right), \quad \psi_i \colon \EE_2 \to \EE_2,
        \]
        отображение
        \[
            \xx \to \xx \oplus \Psi(\ff_n(\xx)) = 
            \begin{bmatrix}
                x_1 \oplus \psi_1(f_1(x_1, \ldots, x_n))\\
                \vdots \\
                x_n \oplus \psi_n(f_n(x_1, \ldots, x_n))
            \end{bmatrix}
        \]
        является биекцией $\ZZ_2^n \to \ZZ_2^n$.
    \end{proposition}

    \begin{remark}
    \label{remark:proper_quasigroup_alt}
        С помощью утверждения~\ref{thm:regularity_boolean} можно предложить альтернативный способ задания семейств латинских квадратов.
        Введем операции $\ast$: для $\xx, \yy \in \ZZ_2^n$ и наборов отображений 
        \begin{gather*}
            \Phi = (\phi_1, \ldots, \phi_n), \quad \phi_i \colon \ZZ_2 \to \ZZ_2, \\
            \Psi = (\psi_1, \ldots, \psi_n), \quad \psi_i \colon \ZZ_2 \to \ZZ_2,
        \end{gather*}
        зададим $\xx \ast \yy$ равенством
        \[
            \xx \ast \yy = \xx \oplus \Phi(\ff_n(\xx)) \oplus \yy \oplus \Psi(\gf_n(\yy)),
        \]
        где $\ff_n$, $\gf_n$~--- два правильных семейства булевых функций размера $n$.

        Построенная таким образом квазигруппа является главным изотопом группы $\ZZ_2^n$ (см. определение~\ref{def:main_isotopy}).
    \end{remark}


\subsection{Обобщение понятия правильного семейства}
\label{sec:general_proper}
    Понятие правильности семейства может быть перенесено со случая булевых функций на произвольные абелевы группы~\cite{nosov06, nosov06abel, nosov07, nosov08}, поля~\cite{nosov08}, квазигруппы и \mbox{$d$-квазигруппы}~\cite{galatenko2020latin} практически без изменений формулировок.
    Приведем общее определение правильного семейства.

    \begin{definition}
    \label{def:proper_quasi}
        Семейство функций $\ff_n$ на $\QQQ$ называется правильным, если для любых двух неравных наборов 
        \[
            \alpha = (\alpha_1, \ldots, \alpha_n), \quad 
            \beta = (\beta_1, \ldots, \beta_n), \quad 
            \alpha \ne \beta,
        \]
        выполняется следующее условие:
        \[ 
            \exists i \colon \alpha_i \ne \beta_i, \; f_i(\alpha) = f_i(\beta). 
        \]
    \end{definition}

    В наиболее общей форме теорему о правильных семействах, аналогичную утверждению~\ref{thm:properness}, можно сформулировать для прямого произведения \mbox{$(d+1)$-квазигрупп}.

    \begin{proposition}[{~\cite[теорема~5]{galatenko2020latin}, \cite[теорема~4]{galatenko2023proper}}]
    \label{thm:dquasi_proper}
        Рассмотрим следующую конструкцию. 
        Пусть $(Q, h_1), \ldots, (Q, h_n)$~--- \mbox{$(d+1)$-квазигруппы}, 
        \[
            \xx_1, \xx_2, \ldots, \xx_d \in Q^n,
        \]
        $\ff_n$~--- семейство функций на $Q^n$, $\pi_i \colon Q^d \to Q$, $1 \le i \le n$~--- произвольные параметрические функции.
        Зададим операцию $H$ на множестве $(Q, h_1) \times \ldots \times (Q, h_n)$:
        \[
            \vv = H(\xx_1, \ldots, \xx_d),
        \]
        \begin{multline*}
            v_i \; = \; h_i \Big(
                x_1[i], x_2[i], \ldots, x_d[i], \\
                f_i \left( 
                    \pi_1(x_1[1], \ldots, x_d[1]), \; \ldots \; , \pi_n(x_1[n], \ldots, x_d[n])
                \right)
            \Big).
        \end{multline*}
        Операция $H \colon Q^n \times \ldots \times Q^n \to Q^n$ задает структуру $d$-квазигруппы на множестве $Q^n$ для любых параметрических функций $\pi_i$ тогда и только тогда, когда $\ff_n$~--- правильное семейство на $Q^n$.
    \end{proposition}

    \begin{remark}
        Частными случаями рассмотренной конструкции являются конструкции, предложенные в работах~\cite{nosov06, nosov06abel, nosov07, nosov08} (в качестве 3-квазигрупповой операции $h_i$ в них рассматривается операция 3-сложения в абелевой группе $h(x, y, z) = x + y + z$), а также конструкция, предложенная в работе~\cite{plaksina14}, в которой рассматривается конкретная $(d+1)$-квазигрупповая операция $h(x_1, \ldots, x_{d+1}) = x_1 + \ldots + x_{d+1}$ над абелевой группой.
    \end{remark}

    \begin{remark}[о существенной (не)зависимости]
    \label{rem:essential_general}
        Из утверждения~\ref{thm:essential} и замечания~\ref{rem:essential_boolean} следует, что для правильного булева семейства $\ff_n$ $i$-я функция $f_i$ не может существенно зависеть от $x_i$.
        На самом деле, это свойство легко следует из общего определения правильного семейства и выполняется для любых (не только булевых) правильных семейств.
        Если бы в семействе $\ff_n$, заданном на $\QQQ$, $f_i$ зависела бы существенно от $x_i$, то по определению существенной зависимости (см. определение~\ref{def:sufficient_one}) нашлось бы два набора, различающихся только в $i$-й компоненте, на которых $f_i$ принимала бы различные значения:
        \begin{multline*}
            \exists \alpha_1, \ldots, \alpha_{i-1}, \alpha_{i+1}, \ldots, \alpha_n \colon \\ 
            f_i(\alpha_1, \ldots, \alpha_{i-1}, a, \alpha_{i+1}, \ldots, \alpha_n) \ne f_i(\alpha_1, \ldots, \alpha_{i-1}, b, \alpha_{i+1}, \ldots, \alpha_n),
        \end{multline*}
        что противоречит условию правильности: два указанных набора различаются лишь в $i$-й компоненте, но при этом функция $f_i$ на этих двух наборах также принимает различные значения.
    \end{remark}

    \begin{remark}
    \label{rem:antipode}
        Правильное семейство $\ff_n \colon \EE_k^n \to \EE_k^n$ не может принимать \textquote{противоположные} значения (т.е. значения $\alpha, \beta \in \EE_k^n$ с тем свойством, что $\alpha_i \ne \beta_i$, $1 \le i \le n$).
        В противном случае на соответствующих этим значениям прообразах нарушается свойство правильности.
    \end{remark}

    Аналог утверждения~\ref{thm:regularity_boolean} был получен и для абелевых групп~\cite[теорема~2]{nosov06abel}.
    Докажем дальнейшее обобщение критерия регулярности на случай произвольных квазигрупп.
    \begin{theorem}[{\cite[теорема~1]{tsar24}}]
    \label{thm:regularity}
        Семейство $\ff_n$ на $\QQQ$ является правильным тогда и только тогда, когда для любого набора отображений 
        \[
            \psi_i \colon Q_i \to Q_i, \; 1 \le i \le n,
        \]
        следующее отображение из $\QQQ$ в себя биективно:
        \[
            \xx = 
            \begin{bmatrix}
                x_1\\
                \vdots \\
                x_n \\
            \end{bmatrix} 
            \to
            \xx \circ \Psi(\ff_n(\xx))
            = 
            \begin{bmatrix}
                x_1 \circ_1 \psi_1(f_1(x_1, \ldots, x_n)) \\
                \vdots \\
                x_n \circ_n \psi_n(f_n(x_1, \ldots, x_n))
            \end{bmatrix}, \; x_i \in Q_i.
        \]
    \end{theorem}

    \begin{proof}
        Пусть $\ff$~--- правильное семейство на $\QQQ$.
        Покажем, что отображение $\xx \to \xx \circ \Psi(\ff_n(\xx))$ инъективно.
        Пусть $\xx \ne \yy$, $\xx, \yy \in \QQQ$, тогда по условию правильности найдется такой индекс $i$, что $x_i \ne y_i$, но $f_i(\xx) = f_i(\yy)$, а значит, 
        \[
            x_i \circ_i \psi_i(f_i(\xx)) \ne y_i \circ_i \psi_i(f(\yy)).
        \]
        Из конечности $\QQQ$ и инъективности отображения следует его биективность.

        Пусть $\ff$ не является правильным.
        Построим отображение $\Psi$ таким образом, чтобы $\xx \to \xx \circ \Psi(\ff_n(\xx))$ не было биекцией.
        Поскольку $\ff$ не является правильным, то найдутся две точки $\xx \ne \yy$, для которых для всех индексов $i$ со свойством $x_i \ne y_i$ следует $f_i(\xx) \ne f_i(\yy)$.
        Рассмотрим все индексы, в которых наборы $\xx$ и $\yy$ различаются.
        Для каждого подобного индекса зададим $\psi_i$ таким образом, чтобы $x_i \circ_i \psi_i(f_i(\xx)) = \yy_i \circ_i \psi_i(f_i(\yy))$; это можно сделать, зафиксировав $\psi_i(f_i(\xx))$ произвольным образом и доопределив $\psi_i(f_i(\yy))$ из уравнения (из условия на <<плохие>> индексы мы имеем $f_i(\xx) \ne f_i(\yy)$, а значит, определение $\psi_i$ корректно).
        В тех индексах, где $x_i = y_i$, зададим $\psi_i$ как правый нейтральный элемент для $x_i$ для любого значения аргумента.

        Если мы зададим $\psi_i$ обозначенным выше образом, то получим равенство
        \[
            \xx \ne \yy, \quad \xx \circ \Psi(\ff_n(\xx)) = \yy \circ \Psi(\ff_n(\yy)),
        \]
        а значит, отображение не может быть биективным.
    \end{proof}
    
    В случае $Q_i = \ZZ_p = \FF_p$, где $p$~--- простое, теорема~\ref{thm:regularity} может быть усилена следующим образом.
    \begin{proposition}[{\cite[теорема~3]{nosov06}}]
    \label{thm:regularity_fp}
        Семейство $\ff_n$ на $\FF_p^n$, где $\FF_p$~--- простое поле, является правильным тогда и только тогда, когда для любого набора элементов $a_i \in \FF_p$ следующее отображение $\FF_p^n \to \FF_p^n$ биективно:
        \[
            \begin{bmatrix}
                x_1\\
                \vdots \\
                x_n \\
            \end{bmatrix} 
            \to
            \begin{bmatrix}
                x_1 + a_1 \cdot f_1(x_1, \ldots, x_n)\\
                \vdots \\
                x_n + a_n \cdot f_n(x_1, \ldots, x_n)
            \end{bmatrix}.
        \]
    \end{proposition}

    % \TODO{А если поле не простое, а $\FF_q$?}


\subsection{Примеры правильных семейств}
\label{sec:proper_examples}

    В настоящем разделе мы приведем некоторые примеры правильных семейств.

\subsubsection{Константные и треугольные семейства}
\label{sec:triangle}

    \begin{example}[константные функции]
    \label{ex:const}
        Набор константных функций
        \[
            f_1 \equiv q_1, \, \ldots \, ,f_n \equiv q_n, \quad q_i \in Q_i, 1 \le i \le n,
        \]
        является правильным семейством.
    \end{example}

    В статье~\cite{nosov06abel} приводится пример так называемых треугольных правильных семейств.
    Немного обобщая определение из~\cite{nosov06abel}, дадим следующее определение.

    \begin{example}[треугольное семейство]
    \label{ex:triangle}
        Треугольное семейство $\ff_n$ на $Q^n$~--- это семейство функций, которое после переупорядочивания номеров переменных и функций может быть записано в виде:
        \[
            \begin{bmatrix}
                f_{\sigma(1)}(\cdot) \\
                f_{\sigma(2)}(x_{\sigma(1)}) \\
                f_{\sigma(3)}(x_{\sigma(1)}, x_{\sigma(2)}) \\
                \vdots \\
                f_{\sigma(n)}(x_{\sigma(1)}, \ldots, x_{\sigma(n-1)})
            \end{bmatrix},
        \]
        другими словами, есть такое упорядочивание $\sigma \in \SSS_n$ входящих в семейство функций, что каждая последующая функция в семействе может существенно зависеть только от переменных с номерами предыдущих функций.
    \end{example}

    \TODO{добавить ли ссылки на Климова-Шамира, Анашина и других~--- $T$-функции?}

    \begin{remark}[о правильности треугольных семейств]
        Нетрудно убедиться, что треугольные семейства являются правильными: если даны два различных набора $\alpha = (\alpha_1, \ldots, \alpha_n)$ и $\beta = (\beta_1, \ldots, \beta_n)$, и при этом верно: 
        \[
            \alpha_{\sigma(1)} = \beta_{\sigma(1)},
            \ldots,
            \alpha_{\sigma(k)} = \beta_{\sigma(k)},
            \alpha_{\sigma(k+1)} \ne \beta_{\sigma(k+1)},
        \]
        то достаточно взять функцию с номером $\sigma(k+1)$, которая на наборах $\alpha$ и $\beta$ будет давать одинаковый результат: 
        \[
            f_{\sigma(k+1)}(\alpha) = f_{\sigma(k+1)}(\beta).
        \]
    \end{remark}

    Можно также обобщить понятие треугольного семейства следующим образом~\cite[теорема~4]{nosov06}.
    \begin{example}[треугольное расширение]
        Пусть $F^0 = (g_{1,0}, \ldots, g_{n,0})$~--- семейство функций, зависящих от переменных $(x_{1,0}, \ldots, x_{n,0})$.
        Пусть $s_1, \ldots, s_n \in \NN \cup \{0\}$~--- некоторый набор чисел длины $n$.
        Определим функции $f_{i,j}$ следующим образом:
        \begin{gather*} 
            f_{i,1} = F_{i,1}(g_{i,0}),\\ 
            f_{i,2} = F_{i,2}(g_{i,0}, x_{i,1}),\\
            \vdots \\
            f_{i, s_i} = F_{i, s_i}(g_{i,0}, x_{i,1}, \ldots, x_{i, s_i - 1}),\\
            f_{i, 0} = F_{i,0}(g_{i,0}, x_{i,1}, \ldots, x_{i, s_i}),
        \end{gather*} 
        где $F_{i,j}$~--- произвольные функции подходящей арности (если $s_i = 0$, то остается только первая строка).
        Если семейство $F^0$ правильное, то семейство 
        \[
            F = (f_{i,j})_{i=1, \ldots, n, j = 0, \ldots, s_i}
        \]
        также является правильным.
    \end{example}


\subsubsection{Линейные семейства и $g$-семейства}

    Существует еще одно возможное обобщение свойства, указанного в замечании~\ref{rem:essential_general}.
    \begin{definition}
        Определим линейное семейство $\ff_n$ на абелевой группе $\GGG^n$ следующим образом:
        \begin{gather*} 
            f_1(x_1, \ldots, x_n) = a_{11} x_1 + a_{12} x_2 + \ldots + a_{1n} x_n + c_1, \\
            \vdots \\
            f_n(x_1, \ldots, x_n) = a_{n1} x_1 + a_{n2} x_2 + \ldots + a_{nn} x_n + c_n, 
        \end{gather*} 
        где $a_{ij} \in \ZZ$, $c_i \in \GGG$.
    \end{definition}

    Для линейных семейств правильность эквивалентна отсутствию циклов в графе существенной зависимости.
    \begin{proposition}[{\cite[теорема~3]{nosov06abel}}]
        Линейное семейство $\ff_n$ задает правильное семейство на абелевой группе $\GGG^n$ тогда и только тогда, когда граф существенной зависимости $G_{\ff}$ не содержит циклов (в том числе петель).
    \end{proposition}

    Семейство функций, для которых правильность равносильна отсутствию циклов в графе существенной зависимости, можно расширить, введя понятие \mbox{$g$-семейства}~\cite{nosov08}.
    \begin{definition}
        Для фиксированного элемента $g \in \GGG$ будем говорить, что функция $f(x_1, \ldots, x_n) \colon \GGG^n \to \GGG$ является $g$-функцией, если для любой переменной $x_i$, от которой она зависит существенным образом, выполнено условие
        \[
            f(g, \ldots, g, x_i, g, \ldots, g) \not \equiv const.
        \]
    \end{definition}

    В качестве конкретных примеров $g$-функций можно привести следующие:
    \begin{itemize}
        \item $x_1 \vee \ldots \vee x_n$ является $0$-функцией;
        \item $x_1 \wedge \ldots \wedge x_n$ является $1$-функцией;
        \item $x_1 \oplus \ldots \oplus x_n$ является $0$-функцией и $1$-функцией.
    \end{itemize}

    \begin{proposition}[{\cite[теорема~10]{nosov08}}]
        Семейство $g$-функций $\ff_n$ является правильным тогда и только тогда, когда граф существенной зависимости $G_{\ff}$ не содержит циклов.
    \end{proposition}

    \TODO{Добавление примера $g$-семейства, не являющегося линейным}

    Дальнейшее изучение графов существенной зависимости и их матриц инцидентности проводилось в работе~\cite{kozlov08}. 
    Графы существенной зависимости могут упрощать проверку свойства правильности семейства функций~\cite{rykov10, rykov14}: так, возможно свести задачу проверки правильности исходного семейства $\ff$ со всего множества $\left(\mathbb{E}_k^n\right)^2$ на проверку правильности на компонентах сильной связности графа существенной зависимости семейства $\ff$ (подробнее см.~\cite{rykov14}).


\subsubsection{Ортогональные семейства}

    \begin{definition}
        Две функции $f, g \colon \EE_k^n \to \EE_k$ будем называть ортогональными, если для любого \mbox{$\xx \in \EE_k^n$} выполняется условие: 
        \[
            f(\xx) = 0 \text{ или } g(\xx) = 0.
        \] 
    \end{definition}

    Следующий пример правильных семейств приводится в работах~\cite{nosov06, nosov08}.
    \begin{example}[семейство ортогональных функций]
    \label{example:ortho}
        Пусть $\ff_n$~--- семейство попарно ортогональных функций, причем каждая функция $f_i$ не зависит существенно от $x_i$, $1 \le i \le n$.
        Тогда $\ff_n$ является правильным. 
        В частности, семейство
        \begin{equation}
            \label{OrthogExample}
            \aligned
            f_1&=\bar{x}_2 x_3 \cdots x_{n-1} x_n,\\
            f_2&=\bar{x}_3 x_4 \cdots x_{n} x_1,\\
            &\vdots \\
            f_n&=\bar{x}_1 x_2 \cdots x_{n-2} x_{n-1}
            \endaligned
        \end{equation}
        состоит из попарно ортогональных булевых функций, каждая из которых не зависит от одноименной переменной.
        Следовательно, оно является правильным.
    \end{example}

    \begin{remark}
        Требование ортогональности можно обобщить следующим образом: существует $q \in Q$, что для любых $i \ne j$ и любого $\xx \in Q^n$ хотя бы одно из значений $f_i(x)$, $f_j(x)$ равно $q$.
        В частности, при $Q = \EE_k$ и $q = 0$ это свойство означает, что векторы значений функций, составляющих ортогональное семейства, попарно ортогональны (как векторы из $\ZZ^{k^n}$).
    \end{remark}

    \TODO{нужно ли править это место? Вектор значений функции имеет длину $k^n$.}

\subsubsection{Семейства на основе перестановочного многочлена}

    В работе~\cite[теорема~5]{nosov06} приводится следующий пример правильного семейства, заданного для простого поля $\FF_p$.
    \begin{example}[семейство на основе перестановочного многочлена]
    \label{example:permpoly}
        Пусть $\FF_p$~--- простое поле, $\phi$~--- перестановочный многочлен.
        Тогда семейство $\ff_n$ размера $n \ge 3$ на $\FF_p^n$
        \[
            \begin{bmatrix}
                f_1(x_1, \ldots, x_n) \\
                f_2(x_1, \ldots, x_n) \\
                \vdots \\
                f_n(x_1, \ldots, x_n) \\
            \end{bmatrix}
            =
            \begin{bmatrix}
                \phi(x_2 + 1) \cdot \ldots \cdot \phi(x_2 + p - 1) \cdot \phi(x_3) \\
                \phi(x_3 + 1) \cdot \ldots \cdot \phi(x_3 + p - 1) \cdot \phi(x_4) \\
                \quad\vdots \\
                \phi(x_1 + 1) \cdot \ldots \cdot \phi(x_1 + p - 1) \cdot \phi(x_2) \\
            \end{bmatrix}
        \]
        является правильным тогда и только тогда, когда $n$ нечетно.
    \end{example}

    \begin{remark}
    \label{rem:fibo_family}
        Для булева случая можно рассмотреть частный случай конструкции из примера~\ref{example:permpoly}, приведенный в работе~\cite{galatenko20quad}: 
        \begin{equation}
        \label{stronglyquadratic}
        \ff(\xx) = 
        \begin{bmatrix}
                f_1(x_1, \ldots, x_n) \\
                f_2(x_1, \ldots, x_n) \\
                \vdots \\
                f_n(x_1, \ldots, x_n) \\
            \end{bmatrix}
            =
            \begin{bmatrix}
                \overline{x}_2 \cdot x_3 \\
                \overline{x}_3 \cdot x_4 \\
                \vdots \\
                \overline{x}_1 \cdot x_2 \\
            \end{bmatrix}.
        \end{equation}
        Указанное семейство является сильно квадратичным булевым правильным семейством (см. определение~\ref{def:quadlin}) при нечетных $n \ge 3$~\cite[теорема~4]{galatenko20quad}.
    \end{remark}


\subsubsection{Один выделенный класс булевых правильных семейств}
\label{sec:quadfamily}

    Рассмотрим следующее семейство булевых функций~\cite{dm21}.
    \begin{equation}
    \label{example:family1}
        \begin{bmatrix}
            0 \\
            x_1 \\
            x_1 \oplus x_2 \\
            \vdots \\
            x_1 \oplus x_2 \oplus \ldots \oplus x_{n-1}
            \end{bmatrix}
            \bigoplus
            \begin{bmatrix}
            \bigoplus_{i < j, \; i, j \ne 1}^n \; x_i x_j \\
            \bigoplus_{i < j, \; i, j \ne 2}^n \; x_i x_j \\
            \bigoplus_{i < j, \; i, j \ne 3}^n \; x_i x_j \\
            \vdots \\
            \bigoplus_{i < j, \; i, j \ne n}^n \; x_i x_j \\
        \end{bmatrix},
    \end{equation}
    в правой части суммируются все попарные произведения, в которые не входит одноименная с функцией переменная (т.к. в правильном семействе функция $f_i$ заведомо не может зависеть от $x_i$, см. замечание \ref{rem:essential_general}).

    Так, при $n=1$, $n = 2$, $n = 3$ имеем следующие семейства:
    \[
        \begin{bmatrix}
            0 \\
        \end{bmatrix},
        \begin{bmatrix}
            0 \\
            x_1 \\
        \end{bmatrix},
        \begin{bmatrix}
            x_2 x_3 \\
            x_1 \bar{x}_3 \\
            x_1 \vee x_2 \\
        \end{bmatrix}.
    \]

    Нетрудно убедиться, что первые три семейства этой последовательности являются правильными. 
    Докажем следующее утверждение.

    \begin{theorem}[{\cite[теорема~8]{dm21}}]
    \label{thm:quadfamily}
        Булевы семейства, задаваемые формулой (\ref{example:family1}), являются правильными для любого $n \ge 1$.
    \end{theorem}

    \begin{proof}
        Через $\ff_n(x_1, \ldots, x_n)$ обозначим исследуемое семейство размера $n$. 
        Будем доказывать утверждение индукцией по размеру семейства.

        \textbf{База индукции:} для $n = 1, 2, 3$ утверждение верно (прямая проверка по определению).

        \textbf{Индуктивный переход:} пусть семейства $\ff_k$ являются правильными для всех $k < n$. 
        Рассмотрим семейство $\ff_n$ размера $n$.

        Заметим, что на наборах с последней координатой $0$ первые $n-1$ функций семейства задают семейство того же вида размера на 1 меньше:
        \[
            \ff_n(x_1, \ldots, x_{n-1}, 0) = 
            \begin{bmatrix}
                \ff_{n-1}(x_1, \ldots, x_{n-1}) \\
                f_n(x_1, \ldots, x_{n-1})
            \end{bmatrix},
        \]
        поскольку все попарные произведения $x_i x_n$ в квадратичной части обнуляются, линейная часть остается неизменной.

        На наборах с последней координатой $x_n = 1$ аналогичным образом мы получаем, что первые $n-1$ функций семейства задают семейство того же вида размера на 1 меньше, но с инвертированным порядком функций и переменных.
        Используя обозначение, введенное в определении~\ref{def:sigma}, мы можем записать данный факт в следующем виде:
        \[
            \ff_n(x_1, \ldots, x_{n-1}, 1) = 
            \begin{bmatrix}
                \mathsf{inv} (\ff_{n-1})(x_1, \ldots, x_{n-1}) \\
                f_n(x_1, \ldots, x_{n-1})
            \end{bmatrix},
        \]
        где подстановка $\mathsf{inv}$~--- отображение <<переворота>>, ставящее для любого $n$ в соответствие набору $\xx \in Q^n$ набор $\yy \in Q^n$ следующим образом: $y_i = x_{n-i+1}$, $1 \le i \le n$.
        Это верно, поскольку к линейной части каждой функции из семейства добавляется сумма $x_1 \oplus x_2 \oplus \ldots \oplus x_{n-1}$.

        Покажем, что для семейства $\ff_n$ выполняется свойство правильности, то есть для любых неравных наборов $\alpha \ne \beta$ найдется координата $i$, для которой $\alpha_i \ne \beta_i$, но $f_i(\alpha) = f_i(\beta)$.
        Для этого рассмотрим следующие возможные случаи.
        \begin{enumerate}
            \item Последние координаты наборов $\alpha, \beta$ совпадают.
            \item Наборы $\alpha, \beta$ различаются только в последней координате.
            \item Наборы $\alpha, \beta$ различаются не менее чем в трех координатах.
            \item Наборы $\alpha, \beta$ различаются ровно в двух координатах.
        \end{enumerate}
        В случаях 1 и 3 мы воспользуемся индуктивным предположением и сведем задачу к одинаковым семействам меньшего размера $k < n$.
        Случаи 2 и 4 требуют отдельного рассмотрения.

        Если наборы $\alpha, \beta$ таковы, что их последние координаты совпадают (то есть $\alpha_n = \beta_n$), то по индуктивному предположению и в силу строения семейств~$\ff_n$ условие правильности должно выполниться среди первых $n-1$ функций (координат).

        Если $n$~--- единственная позиция, в которой наборы различаются, то ${f_n(\alpha) = f_n(\beta)}$, поскольку $f_n$ не зависит существенно от $x_n$ (а значит, условие правильности выполняется для индекса $n$). 

        Пусть теперь среди первых $n-1$ координаты также есть различия.
        Рассмотрим в таком случае \textbf{предпоследнюю} различающуюся координату:
        \[
            \alpha_k \ne \beta_k, \quad \alpha_{k+1} = \beta_{k+1}, \; \ldots, \; \alpha_{n-1} = \beta_{n-1}.
        \]
        В таком случае мы имеем равенство:
        \[
            \alpha_k \oplus \ldots \oplus \alpha_n = 
            \beta_k \oplus \ldots \oplus \beta_n = t
        \]
        После подстановки в семейство $\ff_n$ последних $(n-k)$ координат наборов получим равенства:

        \begin{gather*}
            \ff_n(x_1, \ldots, x_{k-1}, \alpha_k, \ldots, \alpha_n) = 
            \begin{bmatrix}
                \inv^{t}(\ff_{k-1})(x_1, \ldots, x_{k-1}) \\
                \yy
            \end{bmatrix}, \\
            \ff_n(x_1, \ldots, x_{k-1}, \beta_k, \ldots, \beta_n) = 
            \begin{bmatrix}
                \inv^{t}(\ff_{k-1})(x_1, \ldots, x_{k-1}) \\
                \vv
            \end{bmatrix},
        \end{gather*}
        где $\yy, \vv$~--- некоторые вектора булевых функций длины $n - k + 1$.

        Таким образом, первые $(k-1)$ функций, полученных после подстановки наборов $\alpha_k, \ldots, \alpha_n$ и $\beta_k, \ldots, \beta_n$ соответственно, опять образуют правильное семейство булевых функций рассматриваемого вида (\textquote{прямое} или \textquote{инвертированное}).
        Следовательно, если среди оставшихся $k-1$ координат наборов есть различающиеся, то свойство правильности будет выполняться для какой-либо из первых $k-1$ координат по индуктивному предположению.

        Единственный оставшийся нерассмотренный случай состоит в том, что мы имеем два набора с ровно двумя различными координатами:
        \[
            \alpha_k \ne \beta_k, \alpha_n \ne \beta_n, \; \; \alpha_i = \beta_i \; \; \forall i \ne k, n,
        \]
        и в этом случае необходимо показать, что выполнено хотя бы одно из равенств: 
        $f_k(\alpha) = f_k(\beta)$ или $f_n(\alpha) = f_n(\beta)$. 


        Положим $S = \alpha_1 \oplus \ldots \oplus \alpha_{n} = \beta_1 \oplus \ldots \oplus \beta_{n}$.
        Тогда мы имеем:
        \begin{gather*}
            f_k(\alpha) = \alpha_1 \oplus \ldots \oplus \alpha_{k-1}
            \oplus \bigoplus_{i < j, \; i, j \ne k, n}^n \; \alpha_i \alpha_j
            \oplus \alpha_n \Big(S \oplus \alpha_k \oplus \alpha_n \Big), \\
            f_k(\beta) = \beta_1 \oplus \ldots \oplus \beta_{k-1}
            \oplus \bigoplus_{i < j, \; i, j \ne k, n}^n \; \beta_i \beta_j
            \oplus \beta_n \Big(S \oplus \beta_k \oplus \beta_n \Big).
        \end{gather*}

        Линейные части обоих выражений, а также квадратичная часть, не содержащая членов $\alpha_n$ и $\beta_n$ (выделена в отдельную сумму), совпадают.
        С учетом того, что $\alpha_n \oplus \beta_n = 1$, а также $ \alpha_k \oplus \alpha_n = \beta_k \oplus \beta_n $, 
        мы имеем: 
        \[
            f_k(\alpha) \oplus f_k(\beta) = 
            \alpha_n (S \oplus \alpha_k \oplus \alpha_n) \oplus
            \beta_n(S \oplus \beta_k \oplus \beta_n)  = S \oplus \alpha_k \oplus \alpha_n.
        \]

        Аналогично можно прийти к соотношению для $f_n$:
        \begin{gather*}
            f_n(\alpha) = S \oplus \alpha_n \oplus \bigoplus_{i < j, \; i, j \ne k, n}^n \; \alpha_i \alpha_j \oplus \alpha_k (S \oplus \alpha_k \oplus \alpha_n), \\
            f_n(\beta) = S \oplus \beta_n \oplus \bigoplus_{i < j, \; i, j \ne k, n}^n \; \beta_i \beta_j \oplus \beta_k (S \oplus \beta_k \oplus \beta_n), \\
            f_n(\alpha) \oplus f_n(\beta) = \alpha_n \oplus \beta_n \oplus (\alpha_k \oplus \beta_k) (S \oplus \alpha_k \oplus \alpha_n) = S \oplus \alpha_k \oplus \alpha_n \oplus 1.
        \end{gather*}
        Таким образом, либо $f_k(\alpha) = f_k(\beta)$, либо $f_n(\alpha) = f_n(\beta)$, из чего следует выполнение свойства правильности и в этом случае.
    \end{proof}

    Сделаем несколько наблюдений касательно приведенного класса правильных семейств.
    \begin{enumerate}
        \item Все семейства класса при $n \ge 3$ не являются треугольным: каждая функция в семействе существенно зависит от всех неодноименных переменных.
        \item Каждое из семейств класса при $n \ge 3$ имеет полный граф существенной зависимости.
        \item Полином Жегалкина каждого из семейств класса при $n \ge 3$ имеет степень 2, что может быть использовано при построении квадратичных квазигрупп~\cite{galatenko20quad}.
    \end{enumerate}

    Уточним последнее замечание.

    \begin{theorem}[{\cite[теорема~1]{galatenko23}}]
    \label{thm:strongquad}
        Для $n \ge 3$ семейство~(\ref{example:family1}) является квадратичным строгого типа $Quad^s_{n-1}Lin^s_{1}$ (см. определение~\ref{def:quadlin}) при четных $n$ и квадратичным строгого типа $Quad^s_{n}Lin^s_{0}$ (сильно квадратичным) при нечетных~$n$. 
    \end{theorem}

    \begin{proof}
        Рассмотрим линейную комбинацию 
        \(
            h = \alpha_1 f_1 \oplus \ldots \oplus \alpha_n f_n.
        \)
        При мономе $x_i x_j$ в $h$ стоит коэффициент $A \oplus \alpha_i \oplus \alpha_j$, где $A = \alpha_1 \oplus \ldots \oplus \alpha_n$.
        Рассмотрим условия на коэффициенты $\alpha_1, \ldots, \alpha_n$, при которых квадратичная часть $h$ обращается в нуль.
        Для этого необходимо потребовать, чтобы $A \oplus \alpha_i \oplus \alpha_j = 0$ для всех $1 \le i < j \le n$.
        Из этих условий следует, что все $\alpha_i$ должны быть равны:
        \[
            A \oplus \alpha_1 \oplus \alpha_2 = A \oplus \alpha_2 \oplus \alpha_l, \quad l = 3, \ldots, n,
        \]
        а значит, $\alpha_1 = \alpha_l$, $l = 3, \ldots, n$, а также
        \[ 
            A \oplus \alpha_1 \oplus \alpha_2 = A \oplus \alpha_1 \oplus \alpha_3,
        \]
        а значит, $\alpha_2 = \alpha_3$.
        При четных $n$ у этой системы уравнений есть нетривиальное решение $\alpha_1 = \ldots = \alpha_n = 1$, любая отличная от данной нетривиальная линейная комбинация не обнуляет квадратичную часть, а значит, для четных $n \ge 3$ семейство $\ff_n$ является квадратичным строгого типа $Quad^s_{n-1}Lin^s_{1}$.
        Для нечетных $n$ у системы уравнений нет нетривиальных решений, и следовательно, для нечетных $n$ семейство $\ff_n$ является квадратичным строгого типа $Quad^s_{n}Lin^s_{0}$.
    \end{proof}




\subsection{Элементарные свойства правильных семейств}
\label{sec:proper_properties}

    В настоящем разделе сформулируем некоторые базовые свойства правильных семейств.
    Ранее (см. раздел~\ref{sec:families}) мы ввели преобразования сдвига (определение~\ref{def:shift}), перестановки (определение~\ref{def:sigma}) и проекции (определение~\ref{def:proj}).
    Известно, что эти преобразования сохраняют свойство семейства быть правильным.

    \begin{proposition}[{\cite[замечание~1]{nosov06abel}}]
        \label{thm:outer_shift}
        Пусть $\ff_n$~--- правильное семейство на $\QQQ$, $\ss \in \QQQ$.
        Тогда семейство $\gf_n(\xx) = \ff_n(\xx) \circ \ss$ также является правильным.
    \end{proposition}

    \begin{theorem}
    \label{thm:inner_shift}
        Пусть $\ff_n$~--- правильное семейство на $\QQQ$, $\ss \in \QQQ$.
        Тогда семейство $\gf_n(\xx) = \ff_n(\xx \circ \ss)$ также является правильным.
    \end{theorem}

    \begin{proof}
        Пусть $\xx, \yy \in \QQQ$~--- два неравных набора, рассмотрим наборы $\uu = \xx \circ \ss$, $\vv = \yy \circ \ss$.
        Заметим, что $x_i \ne y_i$ эквивалентно утверждению $u_i \ne v_i$ (следует из свойства сокращения в квазигруппе $Q_i$).
        По свойству правильности семейства $\ff_n$ найдется индекс $i$, что $u_i \ne v_i$, но 
        $f_i(\uu) = f_i(\vv)$.
        Таким образом, найдется индекс $i$, что $x_i \ne y_i$, но $g_i(\xx) = g_i(\yy)$.
    \end{proof}

    \begin{proposition}[{\cite[замечание~3]{nosov06abel}}]
    \label{thm:sigma}
        Пусть $\ff_n$~--- правильное семейство на $Q^n$.
        Тогда семейство $\gf_n(\xx) = \sigma(\ff_n)(\xx)$ также является правильным.
    \end{proposition}

    \begin{proposition}[{\cite[лемма~1]{galatenko2020latin}}]
    \label{thm:proj}
        Пусть $\ff_n$~--- правильное семейство на $\QQQ$, $i \in \{1, \ldots, n\}$, $q \in Q_i$.
        Тогда $\proj_i^{q}(\ff_n)$ также является правильным семейством на $Q_1 \times \ldots \times Q_{i-1} \times Q_{i+1} \times \ldots \times Q_n$.
    \end{proposition}

    Указанные преобразования могут быть использованы для получения новых правильных семейств из уже заданных.
    Также некоторые свойства квазигрупп, задаваемых правильными семействами, сохраняются при переходе к эквивалентному (в смысле действия некоторой группы) семейству, что иногда позволяет сократить перебор.

    В работах~\cite{galatenko21generation, galatenko2022generation} предложен алгоритм генерации равномерного распределения на множестве правильных семейств с помощью $\mathsf{MCMC}$-алгоритма: предложен способ перехода от некоторого фиксированного правильного семейства $\ff$ к новому правильному семейству $\ff'$ с помощью итеративного применения процедуры 
    \[
        \mathsf{Switch}(\ff, i, \alpha), \, 1 \le i \le n, \, \alpha \in \EE_k^{*},
    \]
    которая задается следующим образом:
    \begin{itemize}
        \item рассмотреть все возможные проекции $\ff^{q} \coloneqq \proj_i^{q}(\ff_n)$, $q \in \EE_k$, 
        \item рассмотреть граф с множеством вершин $V = \EE_k^{n-1}$, в котором проводится неориентированное ребро от вершины $\uu = (u_1, \ldots, u_{n-1})$ к вершине $\vv = (v_1, \ldots, v_{n-1})$ тогда и только тогда, когда найдется пара индексов $1 \le i, j \le n-1$, $i \ne j$ таких, что $\ff^{i}(\uu)$ и $\ff^{j}(\vv)$ отличаются во всех позициях, в которых отличаются $\uu$ и $\vv$,
        \item найти компоненты связности полученного графа и перенумеровать их,
        \item задать значение функции $f_i$: на $j$-й компоненте связности полученного графа зададим $f_i \coloneqq \alpha[j]$.
    \end{itemize}
    Для порождения равномерного распределения на множестве всех правильных семейств заданного размера предлагается $\mathsf{MCMC}$-процедура: алгоритм стартует с тождественно равного нулю правильного семейства, на каждом шаге случайно выбирается номер $i$ для проекции и набор $\alpha$ (значения функции $f_i$ на полученных компонентах связности).


\section{Свойства квазигрупп}
\label{sec:quasi_properties}

    В этом разделе мы кратко рассмотрим основные алгебраические свойства квазигрупп, релевантные с точки зрения криптографических приложений: количество ассоциативных троек, полиномиальную полноту, наличие подквазигрупп.
    Приводится обзор существующих результатов по каждому из направлений.

    Упомянутые свойства, а также некоторые другие (в частности, отсутствие левой и правой единицы в квазигруппе), указаны среди основных требований к используемой квазигруппе в работе~\cite{EdonR}, где рассматриваются т.н. \textquote{бесформенные} (shapeless) квазигруппы.
    Заметим также, что существуют также \textquote{геометрические} (т.н. \textquote{нефрактальность}, см. работы~\cite{dimitrova2007classification, falcon2019computational}) и \textquote{статистические} (см. работы~\cite{markovski2005classification, bakeva2011some, ochodkova2009testing, dvorsky2009large}) подходы к оценке криптографического качества квазигруппы.
    

\subsection{Количество ассоциативных троек}
\label{subsec:assoc_problem}
    Для того, чтобы некоторые криптографические примитивы, основанные на квазигрупповом умножении (см. также раздел~\ref{sec:fpe}), были стойкими к криптоанализу, необходимо, чтобы в квазигруппе было как можно меньше ассоциативных троек, то есть, чтобы квазигрупповая операция была как можно менее ассоциативна.
    Так, например, большое количество ассоциативных троек может быть использовано при нахождении коллизий и вторых прообразов для некоторых хэш-функций, построенных на основе квазигруппового умножения~\cite{valent16}.
    Следовательно, с практической точки зрения интересны следующие вопросы:
    \begin{itemize}
        \item каково минимально возможное (и достижимое) число ассоциативных троек для квазигрупп заданного размера?
        \item можно ли построить классы квазигрупп с заданным малым числом ассоциативных троек?
        \item можно ли найти квазигруппы с малым числом ассоциативных троек и компактным описанием (в частности, для которых не нужно было бы хранить всю таблицу умножения в компьютере, а вычислять результат квазигрупповой операции более эффективно)?
    \end{itemize}

    Указанные вопросы, а также тесно связанные с ними (например, каково \textit{минимально возможное} число неассоциативных троек в неассоциативной квазигруппе заданного порядка?) изучались c 1980-х годов и в отрыве от практических приложений (см. работы~\cite{kepka1980note, kepka1981notes, drapal1981note, kotzig83, drapal1983quasigroups}, а также~\cite[задача~1.1]{keedwell}).
    Таким образом, сформулированные вопросы интересны как с точки зрения практики, так и чисто теоретически.
    В этом разделе мы рассматриваем большинство полученных на данный момент результатов по количеству ассоциативных троек в квазигруппах, а также приводим результаты исследований, описывающиx количество ассоциативных троек в квазигруппах, задаваемых правильными семействами булевых функций малых размеров.
    Результаты, полученные в настоящем разделе, были описаны в работе~\cite{tsar24}.


\subsubsection{Предварительные сведения}

    \begin{definition}
        Ассоциативной тройкой называется тройка элементов квазигруппы $a, b, c \in Q$ таких, что выполнено равенство:
        \[
            (a \circ b) \circ c = a \circ (b \circ c).
        \]
        Если указанное равенство не выполняется, то тройка называется неассоциативной.
    \end{definition}

    \begin{definition}[\cite{kotzig83}]
        Индексом ассоциативности $a(Q)$ квазигруппы $Q$ называется число ассоциативных троек в ней.
    \end{definition}

    Индекс ассоциативности, как было отмечено выше (см. раздел~\ref{subsec:assoc_problem}), является важной характеристикой квазигруппы, которая, в частности, показывает, насколько квазигрупповая операция близка к групповой.
    В дальнейшем изложении нам понадобятся следующие обозначения.
    \begin{itemize}
        \item $a(Q)$: индекс ассоциативности квазигруппы $Q$.
        \item $b(Q)$: число неассоциативных троек в квазигруппе $Q$.
        \item $a(n)$: минимальное число ассоциативных троек среди всех квазигрупп порядка $n$.
        \item $a(n, C)$: минимальное число ассоциативных троек среди всех квазигрупп из класса $C$ порядка $n$.
        \item $b(n)$: минимальное число неассоциативных троек среди всех неассоциативных квазигрупп порядка $n$.
        \item $b(n, C)$: минимальное число неассоциативных троек среди всех квазигрупп из класса $C$ порядка $n$.
    \end{itemize}

\subsubsection{Оценки на число ассоциативных троек}

    Очевидно, что число ассоциативных троек в квазигруппе не может превышать $\lvert Q \rvert^3$~---~общего числа всех троек элементов в квазигруппе.
    Данная оценка достижима при условии что $Q$~--- группа.
    Можно легко получить следующую универсальную для всех квазигрупп оценку.
    \begin{proposition}[\cite{ass_summary}]
        Выполняется следующее двойное неравенство:
        \[
            n \le a(n) \le n^3.
        \]
    \end{proposition}

    Утверждение следует из того факта, что в любой квазигруппе для каждого элемента $x \in Q$ существует левая и правая единицы $le(x), re(x) \in Q$ со свойством $le(x) \circ x = x = x \circ re(x)$. 
    Тогда для каждого $x \in Q$ тройка $(le(x), x, re(x))$ является ассоциативной: 
    \[
        (le(x) \circ x) \circ re(x) 
        = x = le(x) \circ (x \circ re(x)).
    \] 

    Одной из первых работ, в которых изучалось число ассоциативных троек в алгебраических структурах, является работа~\cite{kepka1981notes}, автор которой исследовал коммутативные группоиды.
    В работе~\cite{kepka1981notes} было показано, что для коммутативного неассоциативного группоида $Q$ порядка $n$ верны оценки:
    \[
        n^2 \le a(Q) \le n^3 - 2,
    \]
    причем каждая из границ достижима в классе коммутативных группоидов (при $n \ge 3$).
    Также в указанной работе были рассмотрены классы коммутативных квазигрупп, изотопных группам, коммутативных медиальных~\cite[глава~2, определение~7]{belousov} квазигрупп и несколько других классов, для каждого из которых получены похожие оценки ($\Theta(n^2)$ для нижней границы и $\Theta(n^3)$ для верхней).

    Работа~\cite{kepka1980note} также посвящена группоидам (а именно, классу группоидов с сокращением, частными случаями
    которых являются квазигруппы).
    Следствием результатов из работы \cite{kepka1980note} является неравенство $b(n) \ge n$ (т.е. число неассоциативных троек в группоидах $Q$ с сокращениями не может быть меньше, чем $\lvert Q \rvert$)

    В работе \cite{drapal1981note} был рассмотрен класс квазигрупп, изотопных группам, и на него были расширены некоторые результаты из работы~\cite{kepka1981notes}.
    Общим результатом этих работ является следующее наблюдение.
    \begin{proposition}[{\cite[теорема~5.1]{drapal1981note}}]
        Пусть $C$~---~класс всех неассоциативных квазигрупп $Q$, изотопных группам.
        Тогда:
        \begin{gather*}
            b(n, C) \ge 
            \begin{cases}
                4n^2 - 6n, \; n \ge 3, \; n \text{ нечетно;} \\
                4n^2 - 8n, \; n \text{ четно.}
            \end{cases}
        \end{gather*}
    \end{proposition}

    Работа~\cite{drapal1983quasigroups} посвящена смежному вопросу: каково минимальное число неассоциативных троек в неассоциативной квазигруппе?
    В~\cite{drapal1983quasigroups} для исследования величины $b(Q)$ вводится следующая характеристика квазигрупповой операции.

    \begin{definition}
        Для квазигруппы $(Q, \circ)$ определим расстояние до группы $\mathsf{gdist}(Q)$ как минимум среди чисел $\mathsf{dist}(Q, G)$, где $(G, \cdot)$~---~группа, заданная на том же множестве, что и квазигруппа $Q$, а функция $\mathsf{dist}$ определена следующим образом:
        \[
            \mathsf{dist}(Q, G) = \lvert \{(x, y) \in Q^2 \mid x \circ y \ne x \cdot y\} \rvert.
        \] 
    \end{definition}

    \begin{proposition}[{\cite[утверждение~4.1]{drapal1983quasigroups}}]
        Пусть $Q$~---~квазигруппа порядка $n$, $t = \mathsf{gdist}(Q)$.
        Тогда выполнены следующие неравенства:
        \begin{enumerate}
            \item $4tn - 2t^2 - 24t \; \le \; b(Q) \; \le \; 4tn$;
            \item если $t \ge 24$, то $b(Q) \; \ge \; 4tn - 2t^2 - 16t$.
        \end{enumerate}
    \end{proposition}
    Также в~\cite{drapal1983quasigroups} показано, что для всех $n \ge 6$ выполняется неравенство
    \[
        b(n) \le 16n - 64.
    \]
    \COMMENT{Минимальное число НЕассоциативных троек в НЕассоциативной квазигруппе не превышает $16n - 64$. То есть хотим как можно ближе подойти к ассоциативной структуре, не становясь полностью ассоциативными~--- сколько нужно переопределить троек, чтобы сохранить свойство квазигруппы, но не перейти к случаю группы? Не более $16n - 64$}

    Обозначим через $i(Q) = \lvert \{x \in Q \mid x \circ x = x\} \rvert$ количество идемпотентов (см. определение~\ref{def:idempotent}) в квазигруппе $Q$. 
    Основным результатом работы~\cite{groek11} является связь чисел $i(Q)$ и $a(Q)$.
    \begin{proposition}[{\cite[теорема~1.1]{groek11}}]
    \label{proposition:idempotent}
        Для квазигруппы $Q$ выполняется следующее неравенство:
        \[
            a(Q) \ge 2n - i(Q).
        \]
    \end{proposition}
    В частности, из этого результата следует, что если в квазигруппе $Q$ порядка $n$ число ассоциативных троек $a(Q)$ также равно $n$ (т.е. достигается нижняя граница на число ассоциативных троек для квазигруппы порядка $n$), то каждый элемент квазигруппы является идемпотентом: $i(Q)=n$.
    Заметим, что с криптографической точки зрения это требование входит в противоречие с требованием отсутствия подквазигрупп~\cite{EdonR, artamonov18} (в частности, подквазигрупп размера~1).

    Дальнейшие продвижения были получены в работе \cite{drapal2019high}.
    Обозначим через $\delta_L(Q)$ число элементов $a \in Q$, таких что подстановка $L_a$ (см. замечание~\ref{rem:LR}) не имеет неподвижных точек, через $\delta_R(Q)$~--- число элементов $a \in Q$, таких что подстановка $R_a$ не имеет неподвижных точек.
    %Положим $\delta(Q) = \delta_L(Q) + \delta_R(Q)$.
    \TODO{Перепроверить это место}
    \COMMENT{У Drapal/Valent именно так и написано вроде бы}
    \begin{proposition}[{\cite[теорема~2.5]{drapal2019high}}]
        Выполнено следующее неравенство:
        \[
            a(Q) \ge 2n - i(Q) + \delta_L(Q) + \delta_R(Q).
        \]
    \end{proposition}
    Таким образом, если для квазигруппы $Q$ порядка $n$ достигается минимально возможное число ассоциативных троек $a(Q) = n$, то в $Q$ каждый элемент является идемпотентом (т.е., $i(Q) = n$), и у отображений $L_a$, $R_a$ нет неподвижных точек.


\subsubsection{Примеры квазигрупп с заданным числом ассоциативных троек}

    В работах~\cite{kotzig83, ass_summary} приведены несколько примеров классов квазигрупп с малым числом ассоциативных троек, что позволяет получить верхние оценки на минимальное число ассоциативных троек~$a(n)$.

    Так, для случая $n \ne 2 \mod 4$ строится квазигруппа $Q$ на основе коммутативной квазигруппы $(G, +)$ и автоморфизма $\phi \in Aut(G)$ со свойством
    \[
        \phi(x) \ne x \qquad \forall x \in G \backslash \{ 0 \}.
    \]
    Операция $x \circ y$ задается следующим образом:
    \[
        x \circ y = \phi(x + y).
    \]
    Для полученной квазигруппы $Q$ верно равенство $a(Q) = n^2$, а следовательно, 
    \[
        a(n) \le n^2, \quad n \ne 2 \mod 4.
    \]

    Для случая $n = 2 \mod 4$ можно построить квазигруппу $Q$ с индексом ассоциативности $a(Q) = 2n^2$, а следовательно, 
    \[
        a(n) \le 2n^2, \quad n = 2 \mod 4.
    \]

    В работе~\cite{kotzig83} приведен пример класса квазигрупп размера $n$, где $n \ge 6$, $n = 0, 2 \mod 6$, с количеством ассоциативных троек $a(Q) = n^2 - 3n + 3$. 
    Таким образом, в случае $n \ge 6$, ${n = 0, 2 \mod 6}$ мы получаем оценку 
    \[
        a(n) \le n^2 - 3n + 3.
    \]

    В ряде статей~\cite{drapal19nearfield, drapal2019ortho, lisonvek20field} были получены примеры классов \textbf{максимально неассоциативных} квазигрупп, т.е. квазигрупп, для которых $a(Q) = \lvert Q \rvert$.
    В статье~\cite{drapal19nearfield} была дана конструкция на основе т.н. почтиполей (см., например,~\cite{ionin2009}), из которой следует, что $a(n) = n$ для $n = 2^{6k} \cdot r^2$, где $k \ge 0$, $r$ нечетное.
    В частности, $a(p^2) = p^2$ для всех нечетных простых чисел $p$.
    
    Указанный результат был расширен в статьях~\cite{drapal2019ortho} и~\cite{lisonvek20field}.
    Обозначим через $\nu_p(n)$ такое число $e$, что $p^e \divides n$, но $p^{e+1} \nmid n$.
    В статье~\cite{lisonvek20field} показано, что для $n$, удовлетворяющих условиям:
    \[
        \nu_p(n) \ne 1, \; p \in \{3, 5, 7, 11\}, \quad \nu_2(n) \ne 2, 4 \text{ и четно},
    \]
    существует максимально неассоциативная квазигруппа порядка $n$.

    В статье~\cite{drapal2019ortho} показано, что максимально неассоциативная квазигруппа существует для всех достаточно больших порядков $n$, которые \textbf{не имеют} вид $n = 2p_1$ или $n = 2p_1 p_2$, где $p_1$, $p_2$~---~нечетные простые, $p_1 \le p_2 < 2p_1$.
    В частности, существует максимально неассоциативная квазигруппа для простых порядков $p \ge 13$.

\subsubsection{Выводы}
\label{sec:summary_triples}
    Таким образом, из ряда вышеприведенных работ следует, что:
    \begin{enumerate}
        \item $a(n) \ge 2n - i(Q) + \delta_L(Q) + \delta_R(Q)$; 
        \item $a(n) \le n^2, \quad n \ge 3, \quad n \ne 4k+2$;
        \item $a(n) \le 2n^2, \quad n \ge 3$;
        \item $a(n) \le n^2 - 3n + 3, \quad n \ge 6, {n \equiv 0, 2 \mod 6}$; 
        \item Доказано существование максимально неассоциативных квазигрупп размера $n$ (т.е. $a(n) = n$) для большого класса чисел $n$ (см. конструкции на основе полей и почтиполей).
    \end{enumerate}

\subsubsection{Оценка среднего числа ассоциативных троек}
    В работах \cite{valent16, valent18few} предложен еще один подход к подсчету числа ассоциативных троек в квазигруппах. 
    Как известно (см., например,~\cite{artam}), ассоциативные тройки можно рассматривать как неподвижные точки коммутатора отображений $[L_a, R_b]$, где $[x, y] = x^{-1}y^{-1}xy$: если $(a, x, b)$~---~ассоциативная тройка, то выполняется условие 
    \[
        (a \circ x) \circ b = R_b(L_a(x)) = a \circ (x \circ b) = L_a(R_b(x)),
    \]
    то есть $x$ является неподвижной точкой коммутатора: $[L_a, R_b](x)=x$.

    В работах~\cite{valent16, valent18few} предложено оценивать среднее число ассоциативных троек в квазигруппе, где усреднение берется по всем главным изотопам.
    Обозначим через $Q_{\alpha\beta}$ главный изотоп $Q$, заданный операцией 
    \[
        a * b = \alpha(a) \circ \beta(b)
    \]
    \begin{proposition}[{\cite[утверждение~2.1]{valent18few}}]
        Выполнено следующее равенство:
        \[
            \frac{1}{(n!)^2}\sum_{\alpha, \beta \in \SSS_Q}{a(Q_{\alpha\beta})} = \frac{n^3}{n-1}.
        \]
    \end{proposition}

    Идея доказательства состоит в подсчете числа неподвижных точек всех коммутаторов $[L_a, R_b]$ для всех главных изотопов, что, в свою очередь, сводится к задаче подсчета суммы 
    \[
        \sum_{\phi, \psi \in \SSS_Q} \lvert Fix([\phi, \psi]) \rvert,
    \] 
    где $Fix(\pi) = \{x \in Q \mid \pi(x) = x \}$ --- множество неподвижных точек подстановки $\pi \in \SSS_{Q}$.

    Следующее утверждение следует из предыдущего.
    \begin{proposition}[{\cite[следствие~3.5]{valent16}}]
        Выполнено следующее равенство:
        \[
            \frac{1}{(n!)^3}\sum_{\alpha, \beta, \gamma \in \SSS_Q}{a(Q_{\alpha\beta\gamma})} = \frac{n^3}{n-1}.
        \]
    \end{proposition}
    Таким образом, для каждой квазигруппы среднее число ассоциативных троек (при усреднении по всем изотопам квазигруппы) примерно равно $n^2$.

    \begin{proposition}[{\cite[утверждение~2.3]{valent18few}}]
        Выполнено неравенство:
        \[
            \frac{1}{n!} \sum_{\beta}{a(Q_{\alpha\beta})} \ge n^2,
        \]
        и равенство достигается тогда и только тогда, когда $\alpha^{-1}$~---~ортоморфизм квазигруппы $Q$.
    \end{proposition}

\subsubsection{Минимальное число ассоциативных троек в квазигруппах малого порядка}
    В ряде работ~\cite{ass_summary, groek11, valent16} путем перебора были получены точные значения минимального числа ассоциативных троек $a(n)$ для квазигрупп порядка $n \le 7$ (см. таб.~\ref{tab:assoctriples}).
    Для квазигрупп порядка $n = 8, 9$ число $a(n)$ уже не может быть получено путем полного перебора, поэтому в работах~\cite{valent2018small, drapal2019high, drapal2020extreme} был предложен способ сократить перебор.
    С помощью ограниченного перебора были получены точные значения чисел $a(8)$, $a(9)$ и получена оценка снизу для $a(10)$ (а именно, было показано, что не существует квазигрупп порядка 10 с индексом ассоциативности 10).
    Полученные результаты отображены в Таб.~\ref{tab:assoctriples}.
    Заметим, что полученные значения меньше существующих теоретических оценок, приведенных в разделе~\ref{sec:summary_triples}.
    \begin{table}
        \centering
        \captionsetup{justification=centering} % выравнивание подписи по-центру
        \caption{\label{tab:assoctriples} Минимальное число ассоциативных троек для квазигрупп порядка $n \le 10$}
        \begin{tabular}{c|c|c}
            $n$ & $a(n)$ & Работа \\ 
            \toprule
            1 & 1  & \cite{ass_summary} \\
            2 & 8  & \cite{ass_summary} \\
            3 & 9  & \cite{ass_summary} \\
            4 & 16 & \cite{ass_summary} \\
            5 & 15 & \cite{ass_summary} \\
            6 & 16 & \cite{ass_summary} \\
            7 & 17 & \cite{valent16} \\
            8 & 16 & \cite{drapal2019high} \\
            9 & 9  & \cite{valent2018small}  \\
            10 & $>10$ & \cite{drapal2020extreme} \\
            \bottomrule
        \end{tabular}
    \end{table}

\subsubsection{Некоторые результаты о виде ассоциативных троек в квазигруппах, заданных правильными семействами}
\label{sec:assoctriples_proper}

    Обобщим конструкцию, обозначенную в замечании~\ref{remark:proper_quasigroup_alt}.
    Пусть $\ff$, $\gf$~--- два правильных семейства функций размера $n$ над группой $(\GGG^n, +)$.
    Для $\xx, \yy \in \GGG^n$ зададим операцию $\circ$ следующим образом:
    \[
        \xx \circ \yy = \xx + \ff(\xx) + \yy + \gf(\yy).
    \]
    Поскольку отображение $\xx \to \pi_{\ff}(\xx) = \xx + \ff(\xx)$, где $\ff$~--- правильное, является биекцией, то операция $\circ$ задает главный изотоп группы $\GGG^n$ (а значит, задает квазигрупповую операцию).

    Потребуем дополнительно, чтобы группа $\GGG^n$ была коммутативной, и рассмотрим условие на ассоциативность тройки $(\xx,\yy, \mathbf{z})$ в квазигруппе $Q$, построенной по паре правильных семейств $(\ff, \gf)$:
    \begin{multline*}
        (\xx \circ \yy) \circ \mathbf{z} \; = \; ( \xx + \ff(\xx) ) + ( \yy + \gf(\yy) ) \; + \\
        + ( \mathbf{z} + \gf(\mathbf{z}) ) + \ff (\xx + \ff(\xx) + \yy + \gf(\yy) ),
    \end{multline*}
    \begin{multline*}
        \xx \circ (\yy \circ  \mathbf{z}) \; = \; ( \xx + \ff(\xx) ) + ( \yy + \ff(\yy) ) \; + \\
        + (  \mathbf{z} + \gf( \mathbf{z}) ) + \gf ( \yy + \ff(\yy) +  \mathbf{z} + \gf( \mathbf{z}) ),
    \end{multline*}
    и из условия $(\xx \circ \yy) \circ  \mathbf{z} = \xx \circ (\yy \circ  \mathbf{z})$ получаем, что:
    \begin{equation}
        \label{sec:assoceq}
        \ff(\yy) - \gf(\yy) = \ff (\xx + \ff(\xx) + \yy + \gf(\yy) ) - \gf (\yy + \ff(\yy) +  \mathbf{z} + \gf( \mathbf{z}) ).
    \end{equation}

    Из подобного эквивалентного представления относительно легко следуют два наблюдения, которые могут быть доказаны прямой проверкой.
    \begin{theorem} 
        Тройка $(\xx, \yy,  \mathbf{z})$ является ассоциативной в квазигруппе $(\GGG^n, \circ)$, построенной по паре семейств $(\ff, \gf)$, тогда и только тогда, когда тройка $( \mathbf{z}, \yy, \xx)$ является ассоциативной в квазигруппе, построенной по паре семейств $(\gf,\ff)$.
    \end{theorem}
    В частности, индексы ассоциативности квазигрупп, построенных по парам семейств $(\ff, \gf)$ и по парам семейств $(\gf, \ff)$, совпадают.

    \begin{theorem}
        Пусть $\mathcal{A}$~--- такое обратимое линейное отображение (т.е. $\mathcal{A}(\xx+\yy) = \mathcal{A}(\xx) + \mathcal{A}(\yy)$), что семейства 
        \[
            \ff'(\xx) = \mathcal{A}^{-1} ( \ff ( \mathcal{A} (\xx) ) ), \quad \gf'(\yy) = \mathcal{A}^{-1} ( \gf ( \mathcal{A} (\yy) ) )
        \]
        также являются правильными (так, в качестве $\mathcal{A}$ можно рассмотреть преобразование обратимой линейной перекодировки, см. раздел~\ref{sec:reencoding}).
        В таком случае $(\xx, \yy,  \mathbf{z})$ является ассоциативной тройкой для квазигруппы, построенной по паре правильных семейств $(\ff, \gf)$, тогда и только тогда, когда тройка $( \mathcal{A}^{-1}(\xx), \mathcal{A}^{-1}(\yy), \mathcal{A}^{-1}( \mathbf{z}) )$ является ассоциативной для квазигруппы, построенной по паре правильных семейств $(\ff', \gf')$.
    \end{theorem}
    В частности, индексы ассоциативности квазигрупп, построенных по парам семейств $(\ff, \gf)$ и $(\ff', \gf')$, совпадают.

    В случае $\GGG^n = \ZZ_2^n$ выполняется несколько дополнительных свойств.
    \begin{theorem}
        Тройка $(\xx, \yy,  \mathbf{z})$ является ассоциативной для квазигруппы, построенной по паре правильных семейств $(\ff, \gf)$, тогда и только тогда, когда она является ассоциативной для квазигруппы, построенной по паре правильных семейств $(\ff \oplus \alpha, \gf \oplus \alpha)$, где $\alpha \in \ZZ_2^n$.
    \end{theorem}

    Утверждение следует из равенства~(\ref{sec:assoceq}) путем прямой подстановки значений.

    \begin{theorem}
        Количество ассоциативных троек в квазигруппе, построенной по паре правильных булевых семейств $(\ff, \gf)$, четно.
    \end{theorem}

    \begin{proof}
        Зафиксируем значения $\xx$, $\yy$ и найдем все значения $ \mathbf{z}$, которые удовлетворяют требованию ассоциативности~(\ref{sec:assoceq}):
        \[
            \ff(\yy) \oplus \gf(\yy) = \ff ( \xx \oplus \ff(\xx) \oplus \yy \oplus \gf(\yy) )  \oplus \gf ( \yy \oplus \ff(\yy) \oplus  \mathbf{z} \oplus \gf( \mathbf{z}) ) .
        \]
        После фиксации $\xx$, $\yy$, мы получим уравнение на $ \mathbf{z}$ вида
        \begin{equation}
            \label{eq:assocz}
            \gf (  \mathbf{z} \oplus \gf( \mathbf{z}) \oplus \alpha  )  = \beta, \quad \alpha, \beta \in \ZZ_2^n.
        \end{equation}
        Как показано в теореме~\ref{thm:preimage} (см. раздел~\ref{sec:preimage_boolean}), уравнение вида $\gf(t) = \beta$ всегда имеет четное число решений для булевых правильных семейств.
        Поскольку отображение $ \mathbf{z} \to  \mathbf{z} \oplus \gf( \mathbf{z}) \oplus \alpha$ является биекцией, для каждой фиксации переменных $\xx$, $\yy$ уравнение~(\ref{eq:assocz}) будет иметь четное число решений $ \mathbf{z}$.
        Тем самым мы получим четное число ассоциативных троек.
    \end{proof}

    Указанные свойства могут быть использованы при исследовании индексов ассоциативности квазигрупп, построенных по различным парам правильных семейств.

\subsubsection{Алгоритмы проверки ассоциативности}

    В книге~\cite[раздел~1.2]{clifford61} приводится алгоритм проверки ассоциативности для произвольного группоида, который работает со сложностью порядка $\mathcal{O}(k^2 \log k)$ операций вычисления умножения в группоиде (тест Лайта с добавлением процедуры вычисления множества порождающих квазигруппы~\cite{miller1978nlog} размера $\sim \log k$ с временной сложностью $\mathcal{O}(k^2)$ операций).

    В работе~\cite{rajagopalan2000verification} был предложен вероятностный алгоритм проверки ассоциативности операции \textquote{$\circ$}:
    \begin{itemize}
        \item если $\circ$ ассоциативна, то алгоритм всегда выдает верный ответ (операция ассоциативна), 
        \item если $\circ$ неассоциативна, то алгоритм может ошибаться с вероятностью $\varepsilon$.
    \end{itemize}
    Было показано, что время работы алгоритма оценивается величиной $\mathcal{O}(k^2 \cdot \log \frac{1}{\varepsilon})$. 
    В той же работе было показано, что не может быть существенно более быстрого вероятностного (классического) алгоритма, а именно, была получена нижняя оценка времени работы алгоритма в общем случае вида $\mathcal{O}(k^2)$ (для квантовых алгоритмов существуют как стандартные методы ускорения алгоритма, наподобие алгоритма Гровера, так и более быстрые специфические процедуры~\cite{childs2010quantum}).

    Наконец, в работе~\cite{evra2024verifying} был предложен алгоритм со сложностью $\Theta(k^2)$ в модели вычислений $\mathsf{RAM}$ (равнодоступная адресная машина, см., например,~\cite[раздел~2.2]{cormen}).

    Для задачи нахождения числа ассоциативных троек существует <<наивный>> алгоритм со сложностью порядка $\mathcal{O}(k^3)$.
    При поиске примеров квазигрупп с минимальным числом ассоциативных троек может быть использован алгоритм, работающий для частично построенных таблиц умножения~\cite{valent2018small}.


\subsection{Полиномиальная полнота}

    Помимо малого количества ассоциативных троек одним из важных условий в контексте криптографических приложений является полиномиальная полнота алгебраической структуры, над которой мы строим криптографический механизм.
    Как было показано в работах~\cite{nipkow1990unification} и~\cite{horvath2008}, задача проверки разрешимости уравнения (и системы уравнений) над полиномиально (функционально) полной алгеброй является $\mathsf{NP}$-полной задачей (об $\mathsf{NP}$-полных задачах см., например,~\cite[глава~34]{cormen}): сертификатом для неё является запись конкретного решения уравнения или системы, полнота следует из представимости задачи $\mathsf{3SAT}$ в виде уравнения над полиномиально полной алгеброй.
    Свойство полиномиальной полноты дает дополнительные гарантии сложности разрешимости задач, используемых как базовые в криптографических приложениях.

    \begin{definition}
        Обозначим через $\mathcal{O}^m(Q)$ множество всех $m$-арных операций на множестве $Q$:
        \[
            \mathcal{O}^m(Q) = \{f \mid f \colon Q^m \to Q \}.
        \]
        Также введем обозначение $\mathcal{O}(Q) = \cup_{m = 0}^{\infty} \mathcal{O}^m(Q)$.
        Пусть $(Q, \circ)$~--- некоторая конечная квазигруппа, $Q = \{q_1, \ldots, q_k \}$, через $[X]$ обозначим операцию замыкания множества функций $X$ (см., например,~\cite[часть~I, параграф~5]{yablonski}).
        Квазигруппа $Q$ называется полиномиально полной, если замыкание операции $\circ$ и всех нуль-арных функций (констант) порождает все множество функций на $Q$:
        \[
            [\{ \circ \} \cup \mathcal{O}^0(Q)] = \mathcal{O}(Q).
        \]
        Другими словами, квазигруппа полиномиально полна, когда любую $m$-арную функцию $Q^m \to Q$, $m \in \NN_0$, можно выразить через операцию умножения $\circ$ в квазигруппе и подстановку констант.
    \end{definition}

    \COMMENT{Тут ситуация тоньше, надо различать квазигруппы с одной и с тремя операциями. Это место надо поправить.}
    В работе~\cite{hagemann} было показано, что для конечных алгебр полиномиальная полнота эквивалентна существованию т.н. \textquote{мальцевского оператора} в множестве всех операций над $Q$ совместно с требованием простоты и неаффинности алгебры.
    В~\cite{artamonov2013latin} отмечено, что квазигруппы имеют как минимум два мальцеских оператора, а значит, для квазигрупп вопрос изучения полиномиальной полноты по сути сводится к вопросу о простоте и неаффинности квазигруппы.
    Далее в разделе мы формально введем все упомянутые понятия и рассмотрим существующие результаты.

    Из результатов работ~\cite{salomaa63, cameron92} следует, что почти все квазигруппы полиномиально полны (т.е. доля полиномиально полных квазигрупп среди всех квазигрупп порядка $k$ при $k \to \infty$ стремится к 1).
    В работе~\cite{galatenko22} указанный результат усилен: почти все квазигруппы сильно полиномиально полны (т.е. не изотопны квазигруппам, не являющимся полиномиально полными).


\subsubsection{Критерии и достаточные условия полиномиальной полноты}

    Как было отмечено выше, для квазигрупп полиномиальная полнота эквивалентна простоте и неаффинности.

    \begin{definition}
        Разбиением множества $Q$ назовем набор $A_1, \ldots, A_t$ непересекающихся подмножеств $Q$ со свойством
        \[
            A_1 \sqcup \ldots \sqcup A_t = Q.
        \]
        Разбиение называется нетривиальным, если $t > 1$, все $A_i$ непусты и существует $A_i$ с условием $|A_i| > 1$. 
    \end{definition}

    \begin{definition}
    \label{def:action}
        Пусть $\GGG$~--- некоторая группа.
        Говорят, что группа $\GGG$ действует (слева) на множестве $M$, если задан гомоморфизм 
        \[
            \Psi \colon \GGG \to S_M,
        \]
        то есть каждому элементу группы $g \in G$ ставится в соответствие биекция на множестве $M$. 
        Гомоморфизм $\Psi$ называется действием группы $\GGG$ на множестве $M$.
    \end{definition}
    
    Для краткости операцию $\Psi(g)(x)$ будем обозначать через $g \cdot x$, где $g \in \GGG$, $x \in M$.

    \begin{definition}
    \label{def:transitivity}
        Действие $\Psi$ группы $\GGG$ на множестве $M$ называется транзитивным, если 
        \[
            \forall x \in M \; \forall y \in M \; \exists g \in \GGG \colon g \cdot x = y.
        \]
        Аналогично, действие называется $t$-транзитивным, если для любых подмножеств $\{x_1, \ldots, x_t\} \subseteq M$, $\{y_1, \ldots, y_t\} \subseteq M$ мощности $t$ найдется элемент $g \in \GGG$, что $g \cdot x_i = y_i$, $1 \le i \le t$.
    \end{definition}

    \begin{definition}
        Действие группы $G$ на множестве $Q$ называется примитивным, если оно транзитивно и не сохраняет никаких нетривиальных разбиений.
    \end{definition}

    \begin{definition}
        Пусть задано некоторое разбиение $A_1, \ldots, A_t$ множества $Q$.
        Введем отношение эквивалентности: $a \sim b$, если $a, b \in A_i$, то есть принадлежат одному и тому же блоку разбиения.
        Квазигруппа $(Q, \circ)$ сохраняет разбиение $A_1 \sqcup \ldots \sqcup A_t$, если для любой пары наборов $(a_1, a_2)$, $(b_1, b_2)$ из выполнения равенств $a_1 \sim b_1$ и $a_2 \sim b_2$ следует $a_1 \circ a_2 \sim b_1 \circ b_2$. 
    \end{definition}

    \begin{definition}
        Квазигруппа $(Q, \circ)$ называется простой, если она не сохраняет никакое нетривиальное разбиение.
    \end{definition}

    \begin{definition}
        Квазигруппа $(Q, \circ)$ называется аффинной (или $T$-квазигруппой), если на множестве $Q$ можно так ввести структуру абелевой группы $(Q, +)$, что квазигрупповая операция выражается через введенную групповую следующим образом:
        \[
            x \circ y = \phi(x) + \psi(y) + c,
        \]
        где $\phi, \psi \in Aut(Q, +)$, $c \in Q$.
    \end{definition}

    Можно дать несколько альтернативных характеризаций указанных выше свойств квазигруппы, связанных с полиномиальной полнотой.

    \begin{definition}
        Обозначим через $Mult(Q)$ группу всех подстановок, порождаемых левыми и правыми сдвигами:
        \[
            Mult(Q) = \langle L_{q_1}, \ldots, L_{q_k}, R_{q_1}, \ldots, R_{q_k} \rangle.
        \]
    \end{definition}

    \begin{definition}
        Обозначим через $G(Q)$ подгруппу в группе $Mult(Q)$, порождаемую следующими подстановками:
        \[
            G(Q) = \langle L_{q_i} \circ L_{q_j}^{-1}, \; R_{q_i} \circ R_{q_j}^{-1}, 1 \le i, j \le k \rangle.
        \]
    \end{definition}

    \begin{definition}

    \end{definition}

    Можно получить несколько достаточных условий полиномиальной полноты в терминах групп $Mult(Q)$ и $G(Q)$.

    \begin{proposition}[\cite{artamonov18}]
        Квазигруппа $Q$ проста тогда и только тогда, когда $Mult(Q)$ действует примитивно на $Q$.
    \end{proposition}

    \begin{proposition}[\cite{artamonov18, artam}]
        Если $Mult(Q)$ содержит подгруппу, изоморфную $A_m$, где $m \ge \max( \frac{k}{2} + 1, 5)$, $A_m$~--- знакопеременная группа степени $m$, то $Q$ полиномиально полна.
    \end{proposition}

    В частности, отсюда следует, что если $Mult(Q) = \SSS_Q$ и $|Q| \ge 5$, то $Q$ является полиномиально полной.

    \begin{proposition}[\cite{artamonov18, artamonov2021constructions}]
        Если $G(Q)$ действует 2-транзитивно на $Q$, $\lvert Q \rvert \ge 3$, то $Q$ полиномиально полна.
    \end{proposition}

    \begin{remark}[\cite{artam}]
        Для квазигрупп, размер которых не представим в виде $p^{\alpha}$, где $p$~---~простое число, полиномиальная полнота эквивалентна простоте квазигруппы.
    \end{remark}
    
    В работе~\cite{yugai17} приводится критерий полиномиальной полноты в терминах предполных классов функций $k$-значной логики.
    Указанный результат был расширен в работе~\cite{chap24} на случай $d$-квазигрупп.

\subsubsection{Проверка полиномиальной полноты для квазигрупп малых порядков}

    В работах~\cite{artamonov2013latin, artamonov2016characterization} приведены критерии полиномиальной полноты и классификация квазигрупп порядка~4.
    В работе~\cite{khalitova24} было замечено, что классификация из~\cite{artamonov2016characterization} немного некорректна, и была предложена полная исправленная классификация квазигрупп порядка~4: всего имеется 384 полиномиально полных квазигрупп порядка 4, 104 простых и аффинных квазигрупп, 88 непростых и аффинных квазигрупп.

    В работе~\cite{piven18} изучаются латинские квадраты размера $4 \times 4$, порожденные правильными семействами размера 2 на предмет полиномиальной полноты. 
    В работе используется критерий, полученный в работе~\cite{artamonov2013latin} для квазигрупп размера 4.
    Установлено, что квазигруппы, получаемые с помощью операции 
    \[
        (x, y) \to x \oplus y \oplus \ff(\pi(x, y))
    \]
    не являются полиномиально полными ни для какого правильного семейства $\ff$ размера 2 и ни для каких наборов параметрических функций $\pi = (\pi_1, \pi_2)$.
    Класс порождаемых правильными семействами квазигрупп можно расширить за счет т.н. перестановочной конструкции, подробно рассматриваемой в~\cite{piven19}.
    Перестановочная конструкция является частным случаем изотопии латинского квадрата. 
    При этом получаемые квазигруппы могут оказаться полиномиально полными.

\subsubsection{Проверка полиномиальной полноты квазигруппы}

    Работа~\cite{galatenko16polycomp} посвящена изучению полиномиальной полноты для квазигрупп простого порядка $k = p$.
    Для таких квазигрупп достаточно проверить, что квазигрупповая операция не является линейной ни для какой биекции $Q \to \ZZ_p$, что может быть выполнено за время, полиномиальное от размера квазигруппы (а точнее, за $O(k^3)$ вычислений квазигрупповой операции).
    В работе~\cite{galatenko18polycomp} приведено обобщение алгоритма с квазигрупп простого порядка на $d$-квазигруппы (латинские гиперкубы) простого порядка со сложностью $O(k^{d+1})$.
    В работе~\cite{galatenko18polycomp2} описан алгоритм проверки простоты квазигруппы, основанный на определении простоты. 
    Для проверки простоты строятся все возможные транзитивные замыкания отношения эквивалентности $a_1 \sim a_i$ для $i = 2, \ldots, k$, где $\lvert Q \rvert = k$.
    Сложность алгоритма составляет $\mathcal{O}(k^4)$ квазигрупповых операций, то есть полиномиальна по размеру квазигруппы.
    В той же статье~\cite{galatenko18polycomp2} описан алгоритм проверки аффинности со сложностью $\mathcal{O}(k^3)$.

    В статье~\cite{galatenko2020efficient} рассматривается дальнейшая оптимизация алгоритма проверки с помощью параллельных вычислений и дополнительных оптимизаций исходного алгоритма, за счет чего удалось понизить сложность с $\mathcal{O}(k^4)$ до $\mathcal{O}(k^3)$ операций в квазигруппе.
    Статьи \cite{galatenko20check, galatenko21npolycomplete} посвящены рассмотрению алгоритма проверки полиномиальной полноты для $d$-квазигрупп, являющегося прямым обобщением алгоритма, предложенного в~\cite{galatenko18polycomp2}.

    Комбинируя все упомянутые выше результаты, можно получить следующий алгоритм проверки полиномиальной полноты квазигруппы.
    \begin{enumerate}
        \item Если порядок квазигруппы является простым числом, $k = p$, то необходимо проверить только неаффинность, что может быть выполнено за $\mathcal{O}(k^3)$ шагов.
        \item Если порядок квазигруппы является степенью простого числа, $k = p^{\alpha}$, где $\alpha \ge 2$, то необходимо проверить и простоту, и неаффинность, что может быть сделано за $\mathcal{O}(k^3)$ шагов.
        \item Во всех остальных случаях достаточно проверять только простоту, что может быть сделано за $\mathcal{O}(k^3)$ шагов.
    \end{enumerate}

    Отметим также, что проверка неаффинности может быть ускорена за счет более быстрого алгоритма проверки неассоциативности (см.~\cite{rajagopalan2000verification, evra2024verifying}).



\subsection{Наличие подквазигрупп}
\label{sec:subquasi}
    Третьим важным криптографическим свойством является отсутствие нетривиальных подквазигрупп в рассматриваемой квазигруппе.
    Здесь также может быть применен \textquote{наивный} алгоритм построения замыкания одноэлементного множества до подквазигруппы (см.~\cite{toropov18, sobyanin19}). 
    Предложенный алгоритм имеет временную сложность $\mathcal{O}(k^3)$ квазигрупповых операций.
    Также было показано~\cite{galatenko2022algorithms}, что алгоритм может быть расширен на случай задачи проверки существования подквазигруппы размера $\ge t$, при этом временная сложность алгоритма будет равна $\mathcal{O}(k^{2+t})$.

    Дальнейшее улучшение было получено в~\cite{galatenko21subquasi}. 
    Модифицированный алгоритм учитывает возможность того, что в квазигруппе каждый элемент может образовывать подквазигруппу (каждый элемент является идемпотентом $x \circ x = x$).
    В таком случае алгоритм из работ~\cite{toropov18, sobyanin19} либо закончит работу, не перейдя к 2-элементным множествам, либо будет вынужден перебирать все возможные пары стартовых элементов, что даст временную сложность проверки порядка $\mathcal{O}(k^4)$.
    Алгоритмы, приводимые в~\cite{galatenko21subquasi} имеют следующую временную сложность:
    \begin{itemize}
        \item $\mathcal{O}(k^{7/3} \cdot \left( \log k \right)^{2/3})$ для алгоритма проверки существования любой собственной подквазигруппы, 
        \item $\mathcal{O}(k^3 \log k)$ для алгоритма проверки существования собственной подквазигруппы размера не менее~2.
    \end{itemize}
    Улучшение достигается за счет использования свойства \textquote{монотонности} замыкания, что позволяет рассматривать лишь экстремальные случаи.
    Алгоритм напрямую обобщается на случай $d$-квазигрупп~\cite{galatenko21nsubquasi}.

    С помощью аппарата теории графов описанные выше алгоритмы были ещё несколько улучшены в работе~\cite{mazurin23}.
    Так, в частности, были получены следующие результаты:
    \begin{itemize}
        \item проверка наличия собственной подквазигруппы размера $\ge 1$ имеет временную сложность $\mathcal{O}(k^{7/3})$, пространственную сложность $\mathcal{O}(k^{2})$,
        \item проверка наличия нетривиальной собственной подквазигруппы (т.е. размера $\ge 2$) имеет временную сложность $\mathcal{O}(k^{3})$, пространственную сложность $\mathcal{O}(k^{3})$,
        \item проверка наличия собственной $d$-подквазигруппы размера $\ge 1$ имеет временную сложность 
        \[
            \mathcal{O} \left( k^{\frac{d^2 + d + 1}{d + 1}} \right)
        \]
        и пространственную сложность $\mathcal{O}(k^{d})$,
        \item проверка наличия нетривиальной собственной $d$-подквазигруппы (т.е. размера $\ge 2$) имеет временную сложность 
        \[
            \mathcal{O} \left( k^{\frac{d^2 + 2d + 4}{d + 2}} \right)
        \]
        и пространственную сложность $\mathcal{O}\left( \max \left(k^{d}, k^{16/5} \right) \right)$.
    \end{itemize}

\subsection{Заключение}

    Квазигруппа, являющаяся полиномиально полной, имеющая малое число ассоциативных троек и не имеющая подквазигрупп, может рассматриваться в качестве базисной для построения криптографических примитивов.
    Все указанные свойства могут быть проверены за время, полиномиальное от размера исследуемой квазигруппы.
    Аналогичные результаты могут быть получены и для $d$-квазигрупп.


\section*{Выводы}

    В настоящей главе были введены основные понятия квазигруппы, правильных семейств функций, графа существенной зависимости семейства, рассмотрены преобразования, сохраняющие квазигрупповую структуру и свойство правильности.
    Выделены основные свойства квазигрупп, релевантные с точки зрения криптографических приложений: малое число ассоциативных троек, полиномиальная полнота, отсутствие подквазигрупп; рассмотрены алгоритмы проверки указанных свойств.

    Отдельно рассмотрен один выделенный класс семейств, для которого показано, что этот класс семейств является правильным, а также доказана теорема о сильной квадратичности семейства.
    Введена конструкция, позволяющая строить квазигруппы на основе пары правильных семейств, доказан ряд утверждений о количестве ассоциативных троек в квазигруппах, получаемых с помощью указанной конструкции.